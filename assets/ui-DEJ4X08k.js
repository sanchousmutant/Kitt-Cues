var M=Object.defineProperty;var y=(L,t)=>M(L,"name",{value:t,configurable:!0});import{D as r,U as g,a as c}from"./physics-CneykC2A.js";import{s as p}from"./sound-D3iNkBN9.js";import{g as v,v as T,d as C}from"./utils-mddd3nEY.js";const f=class f{constructor(){this.elements={},this.buttons={},this.scoreElements={},this.volumeControls={},this.isMobile=!1,this.isPortrait=!1,this.deviceInfo=v(),this.initializeElements(),this.setupEventListeners(),this.checkOrientation(),this.applyDeviceOptimizations()}initializeElements(){this.elements.gameArea=document.querySelector(r.GAME_AREA),this.elements.table=document.querySelector(r.TABLE),this.elements.tableContainer=document.querySelector(r.TABLE_CONTAINER),this.elements.cue=document.querySelector(r.CUE),this.elements.aimLine=document.querySelector(r.AIM_LINE),this.elements.powerIndicator=document.querySelector(r.POWER_INDICATOR),this.elements.powerFill=document.querySelector(r.POWER_FILL),this.elements.pyramidContainer=document.querySelector(r.PYRAMID_CONTAINER),this.elements.helpModal=document.querySelector(r.HELP_MODAL),this.elements.rotationNotice=document.querySelector(r.ROTATION_NOTICE),this.elements.trajectoryCanvas=document.querySelector(r.TRAJECTORY_CANVAS),this.buttons.soundToggle=document.querySelector("#sound-toggle"),this.buttons.musicToggle=document.querySelector("#music-toggle"),this.buttons.helpButton=document.querySelector("#help-button"),this.buttons.resetButton=document.querySelector("#reset-button"),this.buttons.closeHelp=document.querySelector("#close-help"),this.buttons.soundToggleLandscape=document.querySelector("#sound-toggle-landscape"),this.buttons.musicToggleLandscape=document.querySelector("#music-toggle-landscape"),this.buttons.helpButtonLandscape=document.querySelector("#help-button-landscape"),this.buttons.resetButtonLandscape=document.querySelector("#reset-button-landscape"),this.scoreElements.scoreDisplay=document.querySelector(r.SCORE_DISPLAY),this.scoreElements.scoreDisplayLandscape=document.querySelector(r.SCORE_DISPLAY_LANDSCAPE),this.elements.gameOverModal=document.querySelector("#game-over"),this.elements.finalScore=document.querySelector("#final-score"),this.buttons.restartButtonModal=document.querySelector("#restart-button-modal"),this.volumeControls.musicVolume=document.querySelector("#music-volume"),this.volumeControls.musicVolumeLandscape=document.querySelector("#music-volume-landscape"),this.elements.mainRightButtonsContainer=document.querySelector("#main-right-buttons-container"),this.elements.mainScoreContainer=document.querySelector("#main-score-container")}setupEventListeners(){this.buttons.soundToggle&&this.addButtonListener(this.buttons.soundToggle,()=>this.toggleSound()),this.buttons.musicToggle&&this.addButtonListener(this.buttons.musicToggle,()=>this.toggleMusic()),this.buttons.helpButton&&this.addButtonListener(this.buttons.helpButton,()=>this.showHelp()),this.buttons.closeHelp&&this.addButtonListener(this.buttons.closeHelp,()=>this.hideHelp()),this.buttons.soundToggleLandscape&&this.addButtonListener(this.buttons.soundToggleLandscape,()=>this.toggleSound()),this.buttons.musicToggleLandscape&&this.addButtonListener(this.buttons.musicToggleLandscape,()=>this.toggleMusic()),this.buttons.helpButtonLandscape&&this.addButtonListener(this.buttons.helpButtonLandscape,()=>this.showHelp()),this.buttons.restartButtonModal&&this.addButtonListener(this.buttons.restartButtonModal,()=>{document.dispatchEvent(new CustomEvent("game-reset-requested"))}),this.volumeControls.musicVolume&&this.volumeControls.musicVolume.addEventListener("input",t=>this.setMusicVolumeFromPercent(t.target.value)),this.volumeControls.musicVolumeLandscape&&this.volumeControls.musicVolumeLandscape.addEventListener("input",t=>this.setMusicVolumeFromPercent(t.target.value)),this.setupModalEventListeners(),this.setupKeyboardListeners(),this.setupResizeListeners()}addButtonListener(t,o){t&&(this.deviceInfo.isTouch?(t.addEventListener("touchstart",e=>{e.preventDefault(),e.stopPropagation(),T(30),o()},{passive:!1}),t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation()})):t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),o()}),t.addEventListener("touchstart",()=>{t.style.transform="scale(0.95)"},{passive:!0}),t.addEventListener("touchend",()=>{t.style.transform="scale(1)"},{passive:!0}),t.addEventListener("mousedown",()=>{t.style.transform="scale(0.95)"}),t.addEventListener("mouseup",()=>{t.style.transform="scale(1)"}))}setupModalEventListeners(){if(!this.elements.helpModal)return;this.elements.helpModal.addEventListener("click",o=>{o.target===this.elements.helpModal&&this.hideHelp()});const t=this.elements.helpModal.querySelector(".bg-white");t&&(t.addEventListener("click",o=>o.stopPropagation()),t.addEventListener("touchstart",o=>o.stopPropagation()),t.addEventListener("touchmove",o=>{o.target.closest(".overflow-y-auto")||o.preventDefault()},{passive:!1}))}setupKeyboardListeners(){document.addEventListener("keydown",t=>{switch(t.key.toLowerCase()){case"escape":this.hideHelp();break;case"h":this.showHelp();break;case"s":this.toggleSound();break;case"m":this.toggleMusic();break}})}setupResizeListeners(){const t=C(()=>this.handleResize(),g.DEBOUNCE_DELAY);window.addEventListener("resize",t),this.deviceInfo.supportsOrientation&&window.addEventListener("orientationchange",()=>{setTimeout(t,g.ORIENTATION_CHANGE_DELAY)})}handleResize(){this.checkOrientation(),this.updateLayout(),this.positionUIElements()}checkOrientation(){this.isMobile=window.innerWidth<=g.MOBILE_BREAKPOINT,this.isPortrait=window.innerHeight>window.innerWidth,this.elements.rotationNotice&&(this.isMobile&&this.isPortrait?this.elements.rotationNotice.style.display="flex":this.elements.rotationNotice.style.display="none")}updateLayout(){if(!this.elements.gameArea||!this.elements.table||!this.elements.tableContainer)return;const t=this.elements.gameArea.getBoundingClientRect(),o=window.getComputedStyle(this.elements.gameArea),e=parseFloat(o.paddingLeft),s=parseFloat(o.paddingRight),n=parseFloat(o.paddingTop),i=parseFloat(o.paddingBottom),l=t.width-e-s,a=t.height-n-i,u=1.5;let h,d;l/a>u?(d=a,h=d*u):(h=l,d=h/u);const m=20,S=h+m*2,E=d+m*2;this.elements.tableContainer.style.width=`${S}px`,this.elements.tableContainer.style.height=`${E}px`,this.elements.tableContainer.style.left=`${e+(l-S)/2}px`,this.elements.tableContainer.style.top=`${n+(a-E)/2}px`,this.elements.table.style.width=`${h}px`,this.elements.table.style.height=`${d}px`,this.elements.table.style.left=`${m}px`,this.elements.table.style.top=`${m}px`,this.applyDynamicScaling(h,d)}applyDynamicScaling(t,o){const e=t/c.BASE_TABLE_WIDTH,s=o/c.BASE_TABLE_HEIGHT,n=Math.min(e,s);this.scaleCats(n),this.scaleBalls(n),this.scalePockets(n),this.scaleCue(n),this.scaleButtons(n),this.scaleScore(n),this.scalePowerIndicator(n)}scaleCats(t){const o=document.querySelectorAll(".cat-container"),{BREAKPOINTS:e,CAT_SCALES:s}=c;let n=s.BASE;const i=window.innerWidth;i<=e.SM?n=s.SM:i<=e.MD?n=s.MD:i<=e.LG&&(n=s.LG),o.forEach(l=>{const a=n*Math.max(.8,t);l.style.transform=`scale(${Math.max(.1,a)})`})}scaleBalls(t){const o=document.querySelectorAll(".billiard-ball"),{BREAKPOINTS:e,BALL_SIZES:s}=c;let n=s.BASE;const i=window.innerWidth;i<=e.SM?n=s.SM:i<=e.MD?n=s.MD:i<=e.LG&&(n=s.LG),o.forEach(l=>{const a=Math.max(8,n*t);l.style.width=`${a}px`,l.style.height=`${a}px`})}scalePockets(t){const o=document.querySelectorAll("[data-pocket]"),{BREAKPOINTS:e,POCKET_SIZES:s}=c;let n=s.BASE;const i=window.innerWidth;i<=e.SM?n=s.SM:i<=e.MD?n=s.MD:i<=e.LG&&(n=s.LG),o.forEach(l=>{const a=Math.max(12,n*t);l.style.width=`${a}px`,l.style.height=`${a}px`})}scaleCue(t){if(!this.elements.cue)return;const{BREAKPOINTS:o,CUE_SIZES:e}=c;let s=e.HEIGHT.BASE,n=e.WIDTH_PERCENT.BASE;const i=window.innerWidth;i<=o.SM?(s=e.HEIGHT.SM,n=e.WIDTH_PERCENT.SM):i<=o.MD?(s=e.HEIGHT.MD,n=e.WIDTH_PERCENT.MD):i<=o.LG&&(s=e.HEIGHT.LG,n=e.WIDTH_PERCENT.LG);const l=Math.max(2,s*t);this.elements.cue.style.height=`${l}px`,this.elements.cue.style.width=`${n}%`}scaleButtons(t){const o=document.querySelectorAll("button"),{BREAKPOINTS:e,BUTTON_SIZES:s}=c;let n=s.FONT.BASE,i=s.PADDING_X.BASE,l=s.PADDING_Y.BASE;const a=window.innerWidth;a<=e.SM?(n=s.FONT.SM,i=s.PADDING_X.SM,l=s.PADDING_Y.SM):a<=e.MD?(n=s.FONT.MD,i=s.PADDING_X.MD,l=s.PADDING_Y.MD):a<=e.LG&&(n=s.FONT.LG,i=s.PADDING_X.LG,l=s.PADDING_Y.LG),o.forEach(u=>{if(u.closest(".landscape-mobile-controls"))return;const h=Math.max(8,n*t),d=Math.max(4,i*t),m=Math.max(2,l*t);u.style.fontSize=`${h}px`,u.style.padding=`${m}px ${d}px`})}scaleScore(t){const o=[this.scoreElements.scoreDisplay,this.scoreElements.scoreDisplayLandscape],{BREAKPOINTS:e,SCORE_SIZES:s}=c;let n=s.FONT.BASE;const i=window.innerWidth;i<=e.SM?n=s.FONT.SM:i<=e.MD?n=s.FONT.MD:i<=e.LG&&(n=s.FONT.LG),o.forEach(l=>{if(!l)return;const a=Math.max(12,n*t);l.style.fontSize=`${a}px`})}scalePowerIndicator(t){if(!this.elements.powerIndicator)return;const{BREAKPOINTS:o,POWER_INDICATOR_SIZES:e}=c;let s=e.WIDTH.BASE,n=e.HEIGHT.BASE;const i=window.innerWidth;i<=o.SM?(s=e.WIDTH.SM,n=e.HEIGHT.SM):i<=o.MD?(s=e.WIDTH.MD,n=e.HEIGHT.MD):i<=o.LG&&(s=e.WIDTH.LG,n=e.HEIGHT.LG);const l=Math.max(50,s*t),a=Math.max(5,n*t);this.elements.powerIndicator.style.width=`${l}px`,this.elements.powerIndicator.style.height=`${a}px`}positionUIElements(){if(!this.elements.gameArea||!this.elements.tableContainer)return;const t=this.elements.gameArea.getBoundingClientRect(),o=this.elements.tableContainer.getBoundingClientRect(),e=Math.min(o.width/c.BASE_TABLE_WIDTH,1.5),s=Math.max(10,20*e);this.positionLeftButtons(t,o,s),this.positionRightElements(t,o,s),this.positionMobileElements(t,o,s)}positionLeftButtons(t,o,e){const s=this.buttons.soundToggle;s!=null&&s.parentElement&&(s.parentElement.style.display="flex",s.parentElement.style.left="",s.parentElement.style.right="")}positionRightElements(t,o,e){const{mainRightButtonsContainer:s,mainScoreContainer:n}=this.elements;if(s){const i=s.offsetWidth,l=s.offsetHeight,a=o.right-t.left+e,u=Math.min(a,t.width-i-e);s.style.position="absolute",s.style.left=`${u}px`,s.style.top=`${o.top-t.top+o.height/2-l/2}px`,s.style.right="auto"}if(n){const i=n.offsetWidth,l=o.right-t.left+e,a=Math.min(l,t.width-i-e);n.style.position="absolute",n.style.left=`${a}px`,n.style.top=`${o.top-t.top+e}px`,n.style.right="auto"}}positionMobileElements(t,o,e){const s=this.buttons.soundToggleLandscape;if(s!=null&&s.parentElement){const i=s.parentElement,l=o.top-t.top-i.offsetHeight-e;i.style.top=`${Math.max(5,l)}px`,i.style.bottom="auto"}const n=this.scoreElements.scoreDisplayLandscape;if(n!=null&&n.parentElement){const i=n.parentElement,l=o.top-t.top-i.offsetHeight-e;i.style.top=`${Math.max(5,l)}px`,i.style.bottom="auto"}}applyDeviceOptimizations(){const t=document.body;if(this.deviceInfo.isIOS){t.classList.add("ios-device"),t.style.overflow="hidden",t.style.position="fixed",t.style.width="100%",t.style.height="100%";const o=document.querySelector('meta[name="viewport"]');o&&o.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover")}this.deviceInfo.isAndroid&&(t.classList.add("android-device"),t.style.transform="translateZ(0)"),this.deviceInfo.isSamsung&&t.classList.add("samsung-browser")}toggleSound(){p.toggleSound(),this.updateSoundButtons()}toggleMusic(){p.toggleMusic(),this.updateMusicButtons()}updateSoundButtons(){const t=p.isSoundEnabled,o=t?"ðŸ”Š":"ðŸ”‡",e=t?"ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð·Ð²ÑƒÐºÐ¾Ð²Ñ‹Ðµ ÑÑ„Ñ„ÐµÐºÑ‚Ñ‹":"Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð·Ð²ÑƒÐºÐ¾Ð²Ñ‹Ðµ ÑÑ„Ñ„ÐµÐºÑ‚Ñ‹";this.buttons.soundToggle&&(this.buttons.soundToggle.textContent=o,this.buttons.soundToggle.title=e),this.buttons.soundToggleLandscape&&(this.buttons.soundToggleLandscape.textContent=o,this.buttons.soundToggleLandscape.title=e)}updateMusicButtons(){const t=p.isMusicEnabled,o=t?"ðŸŽµ":"ðŸ”‡",e=t?"ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ„Ð¾Ð½Ð¾Ð²ÑƒÑŽ Ð¼ÑƒÐ·Ñ‹ÐºÑƒ":"Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ„Ð¾Ð½Ð¾Ð²ÑƒÑŽ Ð¼ÑƒÐ·Ñ‹ÐºÑƒ";this.buttons.musicToggle&&(this.buttons.musicToggle.textContent=o,this.buttons.musicToggle.title=e),this.buttons.musicToggleLandscape&&(this.buttons.musicToggleLandscape.textContent=o,this.buttons.musicToggleLandscape.title=e)}setMusicVolumeFromPercent(t){const o=Math.max(0,Math.min(100,Number(t))),e=o/100;p.setMusicVolume(e),this.volumeControls.musicVolume&&this.volumeControls.musicVolume.value!==t&&(this.volumeControls.musicVolume.value=String(o)),this.volumeControls.musicVolumeLandscape&&this.volumeControls.musicVolumeLandscape.value!==t&&(this.volumeControls.musicVolumeLandscape.value=String(o))}updateScore(t){const o=`Ð¡Ñ‡ÐµÑ‚: ${t}`;this.scoreElements.scoreDisplay&&(this.scoreElements.scoreDisplay.textContent=o),this.scoreElements.scoreDisplayLandscape&&(this.scoreElements.scoreDisplayLandscape.textContent=o)}showHelp(){if(this.elements.helpModal){this.elements.helpModal.classList.remove("hidden"),document.body.style.overflow="hidden",document.body.style.touchAction="auto";const t=this.elements.helpModal.querySelector(".overflow-y-auto");t&&(t.scrollTop=0)}}hideHelp(){this.elements.helpModal&&(this.elements.helpModal.classList.add("hidden"),document.body.style.overflow="",document.body.style.touchAction="none")}get gameArea(){return this.elements.gameArea}get table(){return this.elements.table}get tableContainer(){return this.elements.tableContainer}get cue(){return this.elements.cue}get aimLine(){return this.elements.aimLine}get powerIndicator(){return this.elements.powerIndicator}get powerFill(){return this.elements.powerFill}get pyramidContainer(){return this.elements.pyramidContainer}get resetButton(){return this.buttons.resetButton||null}get resetButtonLandscape(){return this.buttons.resetButtonLandscape||null}get helpModal(){return this.elements.helpModal}get trajectoryCanvas(){return this.elements.trajectoryCanvas}get isMobileDevice(){return this.isMobile}get isPortraitMode(){return this.isPortrait}loadUISettings(){this.updateSoundButtons(),this.updateMusicButtons();const t=Math.round(p.getMusicVolume*100);this.volumeControls.musicVolume&&(this.volumeControls.musicVolume.value=String(t)),this.volumeControls.musicVolumeLandscape&&(this.volumeControls.musicVolumeLandscape.value=String(t))}showGameOver(t,o){if(this.elements.gameOverModal&&(this.elements.gameOverModal.style.display="flex",this.elements.finalScore&&(this.elements.finalScore.textContent=t.toString()),o)){const e=document.getElementById("stat-player-shots"),s=document.getElementById("stat-cat-hits"),n=document.getElementById("stat-fouls");e&&(e.textContent=o.playerShots.toString()),s&&(s.textContent=o.catHits.toString()),n&&(n.textContent=o.foulCount.toString())}}hideGameOver(){this.elements.gameOverModal&&(this.elements.gameOverModal.style.display="none")}};y(f,"UIManager");let b=f;export{b as U};
