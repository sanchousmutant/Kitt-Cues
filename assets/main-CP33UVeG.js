var A=Object.defineProperty;var g=(b,t)=>A(b,"name",{value:t,configurable:!0});import{P as D,J as S,D as x,G as M,b as v}from"./physics-CneykC2A.js";import{s as c}from"./sound-D3iNkBN9.js";import{U as T}from"./ui-DIQCUpB2.js";import{c as m}from"./cats-L49h1Iw0.js";import{v as y,i as w,a as E,d as F,b as R,e as O,c as X,f as L,h as j,s as B,j as Y}from"./utils-mddd3nEY.js";g(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}g(e,"getFetchOpts");function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}g(i,"processPreload")},"polyfill")();const I=class I{constructor(){this.container=null,this.base=null,this.stick=null,this.centerX=0,this.centerY=0,this.maxDistance=35,this.onMoveCallback=null,this.onReleaseCallback=null,this.state={isActive:!1,angle:0,power:0,deltaX:0,deltaY:0},this.initializeElements(),this.setupEventListeners()}initializeElements(){this.container=document.querySelector(".joystick-container"),this.base=document.querySelector(".joystick-base"),this.stick=document.querySelector(".joystick-stick"),!(!this.container||!this.base||!this.stick)&&this.updateCenter()}updateCenter(){if(!this.base)return;const t=this.base.getBoundingClientRect();this.centerX=t.width/2,this.centerY=t.height/2;const e=t.width/2,i=this.stick?this.stick.offsetWidth/2:25;this.maxDistance=e-i-5}setupEventListeners(){this.stick&&(this.stick.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),document.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),document.addEventListener("touchend",this.handleTouchEnd.bind(this),{passive:!1}),this.stick.addEventListener("mousedown",this.handleMouseDown.bind(this)),document.addEventListener("mousemove",this.handleMouseMove.bind(this)),document.addEventListener("mouseup",this.handleMouseUp.bind(this)))}handleTouchStart(t){t.preventDefault(),t.stopPropagation(),this.state.isActive=!0,y(20),this.updateCenter()}handleTouchMove(t){if(!this.state.isActive||!this.base)return;t.preventDefault();const e=t.touches[0];if(!e)return;const i=this.base.getBoundingClientRect(),s=e.clientX-i.left,n=e.clientY-i.top;this.updateStickPosition(s,n)}handleTouchEnd(t){this.state.isActive&&(t.preventDefault(),this.state.isActive=!1,this.resetStick(),this.onReleaseCallback&&this.onReleaseCallback({...this.state}),y(40))}handleMouseDown(t){t.preventDefault(),t.stopPropagation(),this.state.isActive=!0,this.updateCenter()}handleMouseMove(t){if(!this.state.isActive||!this.base)return;const e=this.base.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top;this.updateStickPosition(i,s)}handleMouseUp(){this.state.isActive&&(this.state.isActive=!1,this.resetStick(),this.onReleaseCallback&&this.onReleaseCallback({...this.state}))}updateStickPosition(t,e){if(!this.stick)return;let i=t-this.centerX,s=e-this.centerY;const n=Math.sqrt(i*i+s*s);if(n>this.maxDistance){const r=Math.atan2(s,i);i=Math.cos(r)*this.maxDistance,s=Math.sin(r)*this.maxDistance}this.stick.style.transform=`translate(${i}px, ${s}px)`,this.state.deltaX=i,this.state.deltaY=s,this.state.angle=Math.atan2(s,i),this.state.power=Math.min(n/this.maxDistance,1),this.onMoveCallback&&this.onMoveCallback({...this.state})}resetStick(){this.stick&&(this.stick.style.transform="translate(0px, 0px)",this.state.deltaX=0,this.state.deltaY=0,this.state.angle=0,this.state.power=0)}onMove(t){this.onMoveCallback=t}onRelease(t){this.onReleaseCallback=t}getState(){return{...this.state}}isJoystickActive(){return this.state.isActive}reset(){this.resetStick(),this.state.isActive=!1}};g(I,"JoystickManager");let C=I;const P=class P{constructor(){this.joystickManager=null,this.lastJoystickPower=0,this.isMobile=!1,this.isPortrait=!1,this.didInitialReset=!1,this.trajectoryCtx=null,this.isMobile=w(),this.isPortrait=E(),this.physicsEngine=new D(this.isMobile),this.uiManager=new T,this.gameState={balls:[],cats:[],pockets:[],score:0,animationFrameId:null,cueAngle:0,isDragging:!1,dragStartX:0,dragStartY:0,didInitialReset:!1,soundEnabled:c.isSoundEnabled,musicEnabled:c.isMusicEnabled,isMusicPlaying:c.getIsMusicPlaying,musicVolume:c.getMusicVolume,stats:{playerShots:0,catHits:0,foulCount:0}},this.init()}async init(){document.readyState==="loading"&&await new Promise(t=>{document.addEventListener("DOMContentLoaded",t,{once:!0})}),this.setupEventListeners(),this.uiManager.loadUISettings(),this.joystickManager=new C,this.setupJoystickCallbacks(),this.initializeCats(),this.initializePockets(),this.setupLayout(),this.setupLayout(),this.uiManager.trajectoryCanvas&&(this.uiManager.table&&(this.uiManager.table.style.display="block",this.uiManager.trajectoryCanvas.width=this.uiManager.table.clientWidth,this.uiManager.trajectoryCanvas.height=this.uiManager.table.clientHeight),this.trajectoryCtx=this.uiManager.trajectoryCanvas.getContext("2d")),this.setupPWA()}setupEventListeners(){const t=this.uiManager.gameArea;t&&(this.setupGameControls(t),this.setupUIControls(),this.setupResizeHandlers())}setupGameControls(t){window.addEventListener("mousemove",e=>{const i=e.target instanceof Node&&t.contains(e.target);(this.gameState.isDragging||i)&&(this.aimCue(e),this.updatePowerIndicatorFromEvent(e))}),t.addEventListener("mousedown",e=>this.startDrag(e)),window.addEventListener("mouseup",e=>this.endDrag(e)),window.addEventListener("touchmove",e=>{var s;this.uiManager.helpModal&&!this.uiManager.helpModal.classList.contains("hidden")||e.target.closest(".overflow-y-auto")||(e.preventDefault(),((s=e.touches)==null?void 0:s.length)>0&&(this.aimCue(e),this.updatePowerIndicatorFromEvent(e)))},{passive:!1}),window.addEventListener("touchstart",e=>{var s;if(this.uiManager.helpModal&&!this.uiManager.helpModal.classList.contains("hidden"))return;const i=e.target;i.closest("button")||i.closest(".overflow-y-auto")||i.closest(".joystick-container")||(e.preventDefault(),(s=e.touches)!=null&&s[0]&&(this.startDrag(e),this.aimCue(e),y(20)))},{passive:!1}),window.addEventListener("touchend",e=>{this.uiManager.helpModal&&!this.uiManager.helpModal.classList.contains("hidden")||(this.endDrag(e),this.gameState.isDragging&&y(40))},{passive:!1}),t.addEventListener("contextmenu",e=>e.preventDefault()),t.addEventListener("gesturestart",e=>e.preventDefault()),t.addEventListener("gesturechange",e=>e.preventDefault()),t.addEventListener("gestureend",e=>e.preventDefault())}setupJoystickCallbacks(){this.joystickManager&&(this.joystickManager.onMove(t=>{if(this.gameState.animationFrameId)return;const e=this.gameState.balls.find(n=>n.el.id==="cue-ball");if(!e||!this.uiManager.table)return;const i=t.angle;this.gameState.cueAngle=i,this.updateCuePosition(e),this.updateAimLine(e.x,e.y,i+Math.PI);const s=t.power*S.POWER_MULTIPLIER;this.lastJoystickPower=s,this.updatePowerIndicator(s),t.power>S.MIN_POWER_THRESHOLD&&this.drawTrajectory(e),this.uiManager.aimLine&&this.uiManager.aimLine.classList.add("visible"),this.uiManager.powerIndicator&&this.uiManager.powerIndicator.classList.add("visible")}),this.joystickManager.onRelease(()=>{this.gameState.animationFrameId||(this.hideVisualHelpers(),this.lastJoystickPower>S.MIN_POWER_THRESHOLD*S.POWER_MULTIPLIER&&(this.hitBall(this.lastJoystickPower),this.lastJoystickPower=0))}))}setupUIControls(){this.uiManager.resetButton&&this.addButtonHandler(this.uiManager.resetButton,()=>this.resetGame()),this.uiManager.resetButtonLandscape&&this.addButtonHandler(this.uiManager.resetButtonLandscape,()=>this.resetGame()),document.addEventListener("catnado-finished",()=>{this.uiManager.showGameOver(this.gameState.score,this.gameState.stats)}),document.addEventListener("cat-hit",()=>{this.gameState.stats.catHits++}),document.addEventListener("game-reset-requested",()=>{this.resetGame()}),window.resetGame=()=>this.resetGame()}addButtonHandler(t,e){t.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),e()})}setupResizeHandlers(){const t=F(()=>{this.handleResize(),this.uiManager.positionUIElements(),this.didInitialReset||(this.resetGame(),this.didInitialReset=!0),this.maybeAttemptFullscreen()},100);window.addEventListener("resize",t),window.addEventListener("orientationchange",()=>{setTimeout(t,200)}),setTimeout(t,100),setTimeout(()=>this.uiManager.positionUIElements(),300)}handleResize(){var i,s;const t=((i=this.uiManager.table)==null?void 0:i.offsetWidth)||0,e=((s=this.uiManager.table)==null?void 0:s.offsetHeight)||0;this.isMobile=w(),this.isPortrait=E(),this.physicsEngine.updateSettings(this.isMobile),m.updateMobileSettings(this.isMobile),this.uiManager.checkOrientation(),this.uiManager.updateLayout(),this.uiManager.trajectoryCanvas&&this.uiManager.table&&(this.uiManager.trajectoryCanvas.width=this.uiManager.table.offsetWidth,this.uiManager.trajectoryCanvas.height=this.uiManager.table.offsetHeight),this.initializeCats(),this.initializePockets(),t>0&&e>0?this.updateBallsOnResize(t,e):this.initializeBalls()}updateBallsOnResize(t,e){if(!this.uiManager.table)return;const i=this.uiManager.table.offsetWidth,s=this.uiManager.table.offsetHeight;if(i===0||s===0)return;const n=i/t,r=s/e;if(this.gameState.balls.forEach(a=>{a.x*=n,a.y*=r,a.radius=a.el.offsetWidth/2,a.x=Math.max(a.radius,Math.min(a.x,i-a.radius)),a.y=Math.max(a.radius,Math.min(a.y,s-a.radius)),a.sunk||(a.el.style.transform=`translate(${a.x-a.radius}px, ${a.y-a.radius}px)`)}),this.uiManager.cue&&this.uiManager.cue.style.visibility==="visible"){const a=this.gameState.balls.find(o=>o.el.id==="cue-ball");a&&this.updateCuePosition(a)}}maybeAttemptFullscreen(){const t=E(),e=t!==this.isPortrait;this.isPortrait=t,this.isMobile=w(),this.isMobile&&!this.isPortrait&&!R()&&setTimeout(()=>O(),100),this.isMobile&&this.isPortrait&&R()&&X(),e&&this.isMobile&&y(50)}setupPWA(){window.addEventListener("beforeinstallprompt",t=>{t.preventDefault()}),window.addEventListener("appinstalled",()=>{y([100,50,100])}),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./service-worker.js").then(t=>{}).catch(t=>{})})}setupLayout(){this.uiManager.gameArea&&this.uiManager.gameArea.classList.add("dynamic-scaling")}initializeCats(){this.uiManager.table&&(this.gameState.cats=m.initializeCats(this.uiManager.table))}initializePockets(){if(this.gameState.pockets=[],!this.uiManager.table)return;const t=document.querySelectorAll(x.POCKETS),e=this.uiManager.table.getBoundingClientRect();t.forEach(i=>{const s=i.getBoundingClientRect(),n=s.left-e.left+s.width/2,r=s.top-e.top+s.height/2,a=Math.max(i.offsetWidth,i.offsetHeight)/2;let o=Math.max(v.MIN_RADIUS,a*v.VISUAL_RADIUS_MULTIPLIER);this.isMobile&&(o=Math.max(v.MIN_MOBILE_RADIUS,a*v.MOBILE_VISUAL_RADIUS_MULTIPLIER)),this.gameState.pockets.push({x:n,y:r,radius:o})})}initializeBalls(){if(this.gameState.balls=[],!this.uiManager.table||!this.uiManager.pyramidContainer)return;this.uiManager.pyramidContainer.style.display="block";const t=document.querySelectorAll(x.BILLIARD_BALLS),e=this.uiManager.table.getBoundingClientRect();t.forEach(i=>{i.style.transform="",i.style.display="block";const s=i.getBoundingClientRect(),n=s.left-e.left+s.width/2,r=s.top-e.top+s.height/2,a={el:i,x:n,y:r,vx:0,vy:0,radius:i.offsetWidth/2,sunk:!1};this.gameState.balls.push(a),this.uiManager.table.appendChild(i),i.style.position="absolute",i.style.zIndex="10",i.style.left="0px",i.style.top="0px"}),this.uiManager.pyramidContainer.innerHTML="",this.uiManager.pyramidContainer.style.display="none",this.render()}aimCue(t){const e=this.gameState.balls.find(h=>h.el.id==="cue-ball");if(!e||!t||!this.uiManager.table||!this.uiManager.cue)return;const i=this.uiManager.table.getBoundingClientRect();let s,n;if("touches"in t&&t.touches.length>0)s=t.touches[0].clientX,n=t.touches[0].clientY;else if("clientX"in t)s=t.clientX,n=t.clientY;else return;let r=s-i.left,a=n-i.top;const o=20;r=L(r,o,this.uiManager.table.offsetWidth-o),a=L(a,o,this.uiManager.table.offsetHeight-o);const f=j(e.x,e.y,r,a),u=this.isMobile?.08:.15;this.gameState.cueAngle=B(this.gameState.cueAngle,f,u),this.gameState.isDragging&&this.drawTrajectory(e),this.updateCuePosition(e),this.updateAimLine(e.x,e.y,this.gameState.cueAngle+Math.PI)}updateCuePosition(t){if(!this.uiManager.cue)return;const e=this.gameState.cueAngle*(180/Math.PI),i=t.radius+6,s=t.x+Math.cos(this.gameState.cueAngle)*i,n=t.y+Math.sin(this.gameState.cueAngle)*i;this.uiManager.cue.style.transformOrigin="left center",this.uiManager.cue.style.left="0px",this.uiManager.cue.style.top="0px";const r=parseFloat(this.uiManager.cue.style.height),a=isNaN(r)?this.uiManager.cue.offsetHeight:r;this.uiManager.cue.style.transform=`translate(${s}px, ${n-a/2}px) rotate(${e}deg)`}updateAimLine(t,e,i){if(!this.uiManager.aimLine)return;const s=M.AIM_LINE_LENGTH,n=parseFloat(this.uiManager.aimLine.style.height),r=parseFloat(window.getComputedStyle(this.uiManager.aimLine).height),a=isNaN(n)?isNaN(r)?2:r:n;this.uiManager.aimLine.style.left="0px",this.uiManager.aimLine.style.top="0px",this.uiManager.aimLine.style.width=`${s}px`,this.uiManager.aimLine.style.transform=`translate(${t}px, ${e-a/2}px) rotate(${i*(180/Math.PI)}deg)`,this.uiManager.aimLine.style.transformOrigin="left center",this.gameState.isDragging&&this.uiManager.aimLine.classList.add("visible")}updatePowerIndicator(t){if(!this.uiManager.powerIndicator||!this.uiManager.powerFill)return;const e=Math.min(t/M.MAX_POWER*100,100);if(this.uiManager.powerFill.style.width=`${e}%`,this.gameState.isDragging&&t>0){this.uiManager.powerIndicator.classList.add("visible");const i=this.gameState.balls.find(s=>s.el.id==="cue-ball");i&&(this.uiManager.powerIndicator.style.left=`${i.x}px`,this.uiManager.powerIndicator.style.top=`${i.y}px`,this.uiManager.powerIndicator.style.transform=`translate(-50%, -100%) translateY(-${i.radius+20}px)`)}}updatePowerIndicatorFromEvent(t){if(!this.gameState.isDragging||!this.uiManager.table)return;const e=this.uiManager.table.getBoundingClientRect();let i,s;if("touches"in t&&t.touches.length>0)i=t.touches[0].clientX-e.left,s=t.touches[0].clientY-e.top;else if("clientX"in t)i=t.clientX-e.left,s=t.clientY-e.top;else return;const n=Math.sqrt((i-this.gameState.dragStartX)**2+(s-this.gameState.dragStartY)**2),r=Math.min(n/M.POWER_SENSITIVITY,M.MAX_POWER);this.updatePowerIndicator(r)}startDrag(t){var n,r;if(this.gameState.animationFrameId||((n=t.target)==null?void 0:n.tagName)==="BUTTON"||(r=t.target)!=null&&r.closest("button")||(this.gameState.isDragging=!0,!this.uiManager.table))return;const e=this.uiManager.table.getBoundingClientRect();let i,s;if("touches"in t&&t.touches.length>0)i=t.touches[0].clientX,s=t.touches[0].clientY;else if("clientX"in t)i=t.clientX,s=t.clientY;else return;this.gameState.dragStartX=i-e.left,this.gameState.dragStartY=s-e.top,this.aimCue(t),this.uiManager.aimLine&&this.uiManager.aimLine.classList.add("visible"),this.uiManager.powerIndicator&&this.uiManager.powerIndicator.classList.add("visible")}endDrag(t){var f,u;if(!this.gameState.isDragging||this.gameState.animationFrameId)return;if(((f=t.target)==null?void 0:f.tagName)==="BUTTON"||(u=t.target)!=null&&u.closest("button")){this.gameState.isDragging=!1,this.hideVisualHelpers();return}if(this.gameState.isDragging=!1,!this.uiManager.table)return;const e=this.uiManager.table.getBoundingClientRect();let i,s;"changedTouches"in t&&t.changedTouches.length>0?(i=t.changedTouches[0].clientX,s=t.changedTouches[0].clientY):"clientX"in t?(i=t.clientX,s=t.clientY):(i=this.gameState.dragStartX+e.left,s=this.gameState.dragStartY+e.top);const n=i-e.left,r=s-e.top,a=Y(n,r,this.gameState.dragStartX,this.gameState.dragStartY);let o=Math.min(a/M.POWER_SENSITIVITY,M.MAX_POWER);this.updatePowerIndicator(o),a<10&&(o=this.physicsEngine.getSettings().hitPower),this.hideVisualHelpers(),this.hitBall(o)}drawTrajectory(t){if(!this.trajectoryCtx||!this.uiManager.trajectoryCanvas)return;const e=this.trajectoryCtx,i=this.uiManager.trajectoryCanvas;e.clearRect(0,0,i.width,i.height);const s=this.gameState.cueAngle+Math.PI,n=Math.cos(s),r=Math.sin(s);let a=null,o=null;const f=1e3,u=5;for(let h=0;h<f;h+=u){const d=t.x+n*h,l=t.y+r*h;for(const p of this.gameState.balls){if(p===t||p.sunk)continue;if(Math.sqrt((d-p.x)**2+(l-p.y)**2)<t.radius+p.radius){a={x:d,y:l},o=p;break}}if(a)break;if(d<t.radius||d>i.width-t.radius||l<t.radius||l>i.height-t.radius){a={x:d,y:l};break}}if(a){if(e.save(),e.beginPath(),e.setLineDash([5,8]),e.moveTo(t.x,t.y),e.lineTo(a.x,a.y),e.strokeStyle="rgba(255, 255, 255, 0.4)",e.lineWidth=2,e.stroke(),e.beginPath(),e.arc(a.x,a.y,t.radius,0,Math.PI*2),e.fillStyle="rgba(255, 255, 255, 0.2)",e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.3)",e.stroke(),o){const h=Math.atan2(o.y-a.y,o.x-a.x);e.beginPath(),e.setLineDash([]),e.moveTo(o.x,o.y),e.lineTo(o.x+Math.cos(h)*60,o.y+Math.sin(h)*60),e.strokeStyle="rgba(243, 229, 171, 0.4)",e.lineWidth=2,e.stroke()}e.restore()}}hideVisualHelpers(){this.uiManager.aimLine&&this.uiManager.aimLine.classList.remove("visible"),this.uiManager.powerIndicator&&this.uiManager.powerIndicator.classList.remove("visible"),this.trajectoryCtx&&this.uiManager.trajectoryCanvas&&this.trajectoryCtx.clearRect(0,0,this.uiManager.trajectoryCanvas.width,this.uiManager.trajectoryCanvas.height)}hitBall(t=this.physicsEngine.getSettings().hitPower){if(c.initAudio(),this.gameState.animationFrameId)return;const e=this.gameState.balls.find(i=>i.el.id==="cue-ball");if(e){if(c.playHitSound(t),this.gameState.stats.playerShots++,this.physicsEngine.applyForce(e,this.gameState.cueAngle,t),this.uiManager.cue){const i=this.gameState.cueAngle*(180/Math.PI),s=Math.min(t*.8,30),n=`rotate(${i}deg)`,r=`rotate(${i}deg) translateX(-${s}px)`;this.uiManager.cue.style.transform=r,setTimeout(()=>{this.uiManager.cue&&(this.uiManager.cue.style.transform=n)},100)}this.startGameLoop(),this.uiManager.cue&&(this.uiManager.cue.style.visibility="hidden")}}startGameLoop(){this.gameState.animationFrameId&&cancelAnimationFrame(this.gameState.animationFrameId),this.gameState.animationFrameId=requestAnimationFrame(()=>this.gameLoop())}gameLoop(){this.updatePhysics(),this.render(),this.physicsEngine.areAllBallsStopped(this.gameState.balls)?(this.gameState.animationFrameId=null,this.onGameStopped()):this.gameState.animationFrameId=requestAnimationFrame(()=>this.gameLoop())}updatePhysics(){if(m.updateCatCooldowns(),!this.uiManager.table)return;for(const e of this.gameState.balls){const i=this.physicsEngine.updateBallPhysics(e,this.uiManager.table.offsetWidth,this.uiManager.table.offsetHeight,this.gameState.cats,this.gameState.pockets);e.sunk&&i&&this.onBallSunk(e)}const t=this.gameState.balls.find(e=>e.el.id==="cue-ball");t&&t.sunk&&!this.gameState.isFoulPending&&(c.playCueFall(),this.gameState.isFoulPending=!0),this.physicsEngine.checkBallCollisions(this.gameState.balls)}onBallSunk(t){t.el.id!=="cue-ball"?(this.gameState.score++,this.uiManager.updateScore(this.gameState.score),this.uiManager.table&&(this.gameState.balls.every(i=>i.el.id==="cue-ball"||i.sunk)?m.startCatnado(this.uiManager.table):m.showAllCatsEmoji("ðŸ˜¿",this.uiManager.table))):this.uiManager.table&&m.showAllCatsEmoji("ðŸ˜º",this.uiManager.table)}onGameStopped(){if(this.gameState.isFoulPending){this.gameState.isFoulPending=!1,this.gameState.stats.foulCount++,this.gameState.score=Math.max(0,this.gameState.score-1),this.uiManager.updateScore(this.gameState.score);const e=this.gameState.balls.find(i=>i.el.id==="cue-ball");e&&this.uiManager.table&&(e.sunk=!1,e.x=this.uiManager.table.offsetWidth*.25,e.y=this.uiManager.table.offsetHeight*.5,e.vx=0,e.vy=0,e.el.style.display="block")}const t=this.gameState.balls.find(e=>e.el.id==="cue-ball");t&&!t.sunk&&this.uiManager.cue&&(this.uiManager.cue.style.visibility="visible",this.updateCuePosition(t)),this.render()}render(){this.gameState.balls.forEach(t=>{if(!t.sunk){t.el.style.left="0px",t.el.style.top="0px";const e=parseFloat(t.el.style.width),i=isNaN(e)?t.radius:e/2;t.el.style.transform=`translate(${t.x-i}px, ${t.y-i}px)`}})}resetGame(){this.uiManager.hideGameOver(),this.gameState.animationFrameId&&(cancelAnimationFrame(this.gameState.animationFrameId),this.gameState.animationFrameId=null),this.gameState.score=0,this.gameState.stats={playerShots:0,catHits:0,foulCount:0},this.uiManager.updateScore(this.gameState.score),this.initializePockets(),this.initializeBalls(),m.resetCats(),this.gameState.balls.forEach(e=>{e&&e.el&&(e.sunk=!1,e.vx=0,e.vy=0,e.el.style.display="block")});const t=this.gameState.balls.find(e=>e&&e.el&&e.el.id==="cue-ball");t&&this.uiManager.table&&(t.x=this.uiManager.table.offsetWidth*.25,t.y=this.uiManager.table.offsetHeight*.5),this.positionColoredBalls(),m.resetAllCats(),this.render(),this.showCueAtDefaultPosition()}positionColoredBalls(){var u;if(!this.uiManager.table)return;const t=this.gameState.balls.filter(h=>h&&h.el&&h.el.id!=="cue-ball");if(t.length===0)return;const e=((u=t[0])==null?void 0:u.radius)||12,i=this.uiManager.table.offsetWidth,s=this.uiManager.table.offsetHeight,n=Math.min(i*.6,i-e*8),r=s*.5,a=Math.min(e*2.2,(i-n)/4),o=g((h,d,l)=>{h.x=L(d,e,i-e),h.y=L(l,e,s-e)},"setBallPosition");[[n,r],[n+a,r-a*.5],[n+a,r+a*.5],[n+a*2,r-a],[n+a*2,r],[n+a*2,r+a],[n+a*3,r-a*1.5],[n+a*3,r-a*.5],[n+a*3,r+a*.5],[n+a*3,r+a*1.5]].forEach(([h,d],l)=>{l<t.length&&t[l]&&o(t[l],h,d)})}showCueAtDefaultPosition(){const t=this.gameState.balls.find(e=>e.el.id==="cue-ball");t&&this.uiManager.cue&&(this.uiManager.cue.style.visibility="visible",this.gameState.cueAngle=0,this.updateCuePosition(t))}handleFirstInteraction(){c.initAudio(),c.isMusicEnabled&&c.startBackgroundMusic(),this.maybeAttemptFullscreen()}};g(P,"Game");let k=P;document.addEventListener("DOMContentLoaded",()=>{const b=new k,t=g(()=>{b.handleFirstInteraction(),document.removeEventListener("mousedown",t),document.removeEventListener("touchstart",t)},"startOnFirstInteraction");document.addEventListener("mousedown",t),document.addEventListener("touchstart",t,{passive:!0})});
