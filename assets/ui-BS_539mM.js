var M=Object.defineProperty;var y=(L,e)=>M(L,"name",{value:e,configurable:!0});import{D as r,U as g,a as c}from"./physics-CneykC2A.js";import{s as p}from"./sound-D3iNkBN9.js";import{g as v,v as T,d as C}from"./utils-mddd3nEY.js";const E=class E{constructor(){this.elements={},this.buttons={},this.scoreElements={},this.volumeControls={},this.isMobile=!1,this.isPortrait=!1,this.deviceInfo=v(),this.initializeElements(),this.setupEventListeners(),this.checkOrientation(),this.applyDeviceOptimizations()}initializeElements(){this.elements.gameArea=document.querySelector(r.GAME_AREA),this.elements.table=document.querySelector(r.TABLE),this.elements.tableContainer=document.querySelector(r.TABLE_CONTAINER),this.elements.cue=document.querySelector(r.CUE),this.elements.aimLine=document.querySelector(r.AIM_LINE),this.elements.powerIndicator=document.querySelector(r.POWER_INDICATOR),this.elements.powerFill=document.querySelector(r.POWER_FILL),this.elements.pyramidContainer=document.querySelector(r.PYRAMID_CONTAINER),this.elements.helpModal=document.querySelector(r.HELP_MODAL),this.elements.rotationNotice=document.querySelector(r.ROTATION_NOTICE),this.elements.trajectoryCanvas=document.querySelector(r.TRAJECTORY_CANVAS),this.buttons.soundToggle=document.querySelector("#sound-toggle"),this.buttons.musicToggle=document.querySelector("#music-toggle"),this.buttons.helpButton=document.querySelector("#help-button"),this.buttons.resetButton=document.querySelector("#reset-button"),this.buttons.closeHelp=document.querySelector("#close-help"),this.buttons.soundToggleLandscape=document.querySelector("#sound-toggle-landscape"),this.buttons.musicToggleLandscape=document.querySelector("#music-toggle-landscape"),this.buttons.helpButtonLandscape=document.querySelector("#help-button-landscape"),this.buttons.resetButtonLandscape=document.querySelector("#reset-button-landscape"),this.scoreElements.scoreDisplay=document.querySelector(r.SCORE_DISPLAY),this.scoreElements.scoreDisplayLandscape=document.querySelector(r.SCORE_DISPLAY_LANDSCAPE),this.elements.gameOverModal=document.querySelector("#game-over"),this.elements.finalScore=document.querySelector("#final-score"),this.buttons.restartButtonModal=document.querySelector("#restart-button-modal"),this.volumeControls.musicVolume=document.querySelector("#music-volume"),this.volumeControls.musicVolumeLandscape=document.querySelector("#music-volume-landscape")}setupEventListeners(){this.buttons.soundToggle&&this.addButtonListener(this.buttons.soundToggle,()=>this.toggleSound()),this.buttons.musicToggle&&this.addButtonListener(this.buttons.musicToggle,()=>this.toggleMusic()),this.buttons.helpButton&&this.addButtonListener(this.buttons.helpButton,()=>this.showHelp()),this.buttons.closeHelp&&this.addButtonListener(this.buttons.closeHelp,()=>this.hideHelp()),this.buttons.soundToggleLandscape&&this.addButtonListener(this.buttons.soundToggleLandscape,()=>this.toggleSound()),this.buttons.musicToggleLandscape&&this.addButtonListener(this.buttons.musicToggleLandscape,()=>this.toggleMusic()),this.buttons.helpButtonLandscape&&this.addButtonListener(this.buttons.helpButtonLandscape,()=>this.showHelp()),this.buttons.restartButtonModal&&this.addButtonListener(this.buttons.restartButtonModal,()=>{document.dispatchEvent(new CustomEvent("game-reset-requested"))}),this.volumeControls.musicVolume&&this.volumeControls.musicVolume.addEventListener("input",e=>this.setMusicVolumeFromPercent(e.target.value)),this.volumeControls.musicVolumeLandscape&&this.volumeControls.musicVolumeLandscape.addEventListener("input",e=>this.setMusicVolumeFromPercent(e.target.value)),this.setupModalEventListeners(),this.setupKeyboardListeners(),this.setupResizeListeners()}addButtonListener(e,n){e&&(this.deviceInfo.isTouch?(e.addEventListener("touchstart",s=>{s.preventDefault(),s.stopPropagation(),T(30),n()},{passive:!1}),e.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation()})):e.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),n()}),e.addEventListener("touchstart",()=>{e.style.transform="scale(0.95)"},{passive:!0}),e.addEventListener("touchend",()=>{e.style.transform="scale(1)"},{passive:!0}),e.addEventListener("mousedown",()=>{e.style.transform="scale(0.95)"}),e.addEventListener("mouseup",()=>{e.style.transform="scale(1)"}))}setupModalEventListeners(){if(!this.elements.helpModal)return;this.elements.helpModal.addEventListener("click",n=>{n.target===this.elements.helpModal&&this.hideHelp()});const e=this.elements.helpModal.querySelector(".bg-white");e&&(e.addEventListener("click",n=>n.stopPropagation()),e.addEventListener("touchstart",n=>n.stopPropagation()),e.addEventListener("touchmove",n=>{n.target.closest(".overflow-y-auto")||n.preventDefault()},{passive:!1}))}setupKeyboardListeners(){document.addEventListener("keydown",e=>{switch(e.key.toLowerCase()){case"escape":this.hideHelp();break;case"h":this.showHelp();break;case"s":this.toggleSound();break;case"m":this.toggleMusic();break}})}setupResizeListeners(){const e=C(()=>this.handleResize(),g.DEBOUNCE_DELAY);window.addEventListener("resize",e),this.deviceInfo.supportsOrientation&&window.addEventListener("orientationchange",()=>{setTimeout(e,g.ORIENTATION_CHANGE_DELAY)})}handleResize(){this.checkOrientation(),this.updateLayout(),this.positionUIElements()}checkOrientation(){this.isMobile=window.innerWidth<=g.MOBILE_BREAKPOINT,this.isPortrait=window.innerHeight>window.innerWidth,this.elements.rotationNotice&&(this.isMobile&&this.isPortrait?this.elements.rotationNotice.style.display="flex":this.elements.rotationNotice.style.display="none")}updateLayout(){if(!this.elements.gameArea||!this.elements.table||!this.elements.tableContainer)return;const e=this.elements.gameArea.getBoundingClientRect(),n=window.getComputedStyle(this.elements.gameArea),s=parseFloat(n.paddingLeft),t=parseFloat(n.paddingRight),o=parseFloat(n.paddingTop),i=parseFloat(n.paddingBottom),l=e.width-s-t,a=e.height-o-i,h=1.5;let u,d;l/a>h?(d=a,u=d*h):(u=l,d=u/h);const m=20,f=u+m*2,S=d+m*2;this.elements.tableContainer.style.width=`${f}px`,this.elements.tableContainer.style.height=`${S}px`,this.elements.tableContainer.style.left=`${s+(l-f)/2}px`,this.elements.tableContainer.style.top=`${o+(a-S)/2}px`,this.elements.table.style.width=`${u}px`,this.elements.table.style.height=`${d}px`,this.elements.table.style.left=`${m}px`,this.elements.table.style.top=`${m}px`,this.applyDynamicScaling(u,d)}applyDynamicScaling(e,n){const s=e/c.BASE_TABLE_WIDTH,t=n/c.BASE_TABLE_HEIGHT,o=Math.min(s,t);this.scaleCats(o),this.scaleBalls(o),this.scalePockets(o),this.scaleCue(o),this.scaleButtons(o),this.scaleScore(o),this.scalePowerIndicator(o)}scaleCats(e){const n=document.querySelectorAll(".cat-container"),{BREAKPOINTS:s,CAT_SCALES:t}=c;let o=t.BASE;const i=window.innerWidth;i<=s.SM?o=t.SM:i<=s.MD?o=t.MD:i<=s.LG&&(o=t.LG),n.forEach(l=>{const a=o*Math.max(.8,e);l.style.transform=`scale(${Math.max(.1,a)})`})}scaleBalls(e){const n=document.querySelectorAll(".billiard-ball"),{BREAKPOINTS:s,BALL_SIZES:t}=c;let o=t.BASE;const i=window.innerWidth;i<=s.SM?o=t.SM:i<=s.MD?o=t.MD:i<=s.LG&&(o=t.LG),n.forEach(l=>{const a=Math.max(8,o*e);l.style.width=`${a}px`,l.style.height=`${a}px`})}scalePockets(e){const n=document.querySelectorAll("[data-pocket]"),{BREAKPOINTS:s,POCKET_SIZES:t}=c;let o=t.BASE;const i=window.innerWidth;i<=s.SM?o=t.SM:i<=s.MD?o=t.MD:i<=s.LG&&(o=t.LG),n.forEach(l=>{const a=Math.max(12,o*e);l.style.width=`${a}px`,l.style.height=`${a}px`})}scaleCue(e){if(!this.elements.cue)return;const{BREAKPOINTS:n,CUE_SIZES:s}=c;let t=s.HEIGHT.BASE,o=s.WIDTH_PERCENT.BASE;const i=window.innerWidth;i<=n.SM?(t=s.HEIGHT.SM,o=s.WIDTH_PERCENT.SM):i<=n.MD?(t=s.HEIGHT.MD,o=s.WIDTH_PERCENT.MD):i<=n.LG&&(t=s.HEIGHT.LG,o=s.WIDTH_PERCENT.LG);const l=Math.max(2,t*e);this.elements.cue.style.height=`${l}px`,this.elements.cue.style.width=`${o}%`}scaleButtons(e){const n=document.querySelectorAll("button"),{BREAKPOINTS:s,BUTTON_SIZES:t}=c;let o=t.FONT.BASE,i=t.PADDING_X.BASE,l=t.PADDING_Y.BASE;const a=window.innerWidth;a<=s.SM?(o=t.FONT.SM,i=t.PADDING_X.SM,l=t.PADDING_Y.SM):a<=s.MD?(o=t.FONT.MD,i=t.PADDING_X.MD,l=t.PADDING_Y.MD):a<=s.LG&&(o=t.FONT.LG,i=t.PADDING_X.LG,l=t.PADDING_Y.LG),n.forEach(h=>{if(h.closest(".landscape-mobile-controls"))return;const u=Math.max(8,o*e),d=Math.max(4,i*e),m=Math.max(2,l*e);h.style.fontSize=`${u}px`,h.style.padding=`${m}px ${d}px`})}scaleScore(e){const n=[this.scoreElements.scoreDisplay,this.scoreElements.scoreDisplayLandscape],{BREAKPOINTS:s,SCORE_SIZES:t}=c;let o=t.FONT.BASE;const i=window.innerWidth;i<=s.SM?o=t.FONT.SM:i<=s.MD?o=t.FONT.MD:i<=s.LG&&(o=t.FONT.LG),n.forEach(l=>{if(!l)return;const a=Math.max(12,o*e);l.style.fontSize=`${a}px`})}scalePowerIndicator(e){if(!this.elements.powerIndicator)return;const{BREAKPOINTS:n,POWER_INDICATOR_SIZES:s}=c;let t=s.WIDTH.BASE,o=s.HEIGHT.BASE;const i=window.innerWidth;i<=n.SM?(t=s.WIDTH.SM,o=s.HEIGHT.SM):i<=n.MD?(t=s.WIDTH.MD,o=s.HEIGHT.MD):i<=n.LG&&(t=s.WIDTH.LG,o=s.HEIGHT.LG);const l=Math.max(50,t*e),a=Math.max(5,o*e);this.elements.powerIndicator.style.width=`${l}px`,this.elements.powerIndicator.style.height=`${a}px`}positionUIElements(){if(!this.elements.gameArea||!this.elements.tableContainer)return;const e=this.elements.gameArea.getBoundingClientRect(),n=this.elements.tableContainer.getBoundingClientRect(),s=Math.min(n.width/c.BASE_TABLE_WIDTH,1.5),t=Math.max(10,20*s);this.positionLeftButtons(e,n,t),this.positionRightElements(e,n,t),this.positionMobileElements(e,n,t)}positionLeftButtons(e,n,s){const t=this.buttons.soundToggle;t!=null&&t.parentElement&&(t.parentElement.style.display="flex",t.parentElement.style.left="",t.parentElement.style.right="")}positionRightElements(e,n,s){const t=this.buttons.resetButton;t!=null&&t.parentElement&&(t.parentElement.style.left="",t.parentElement.style.right="",t.parentElement.style.display="block");const o=this.scoreElements.scoreDisplay;o!=null&&o.parentElement&&(o.parentElement.style.display="block",o.parentElement.style.top="",o.parentElement.style.left="",o.parentElement.style.right="",o.parentElement.style.bottom="")}positionMobileElements(e,n,s){const t=this.buttons.soundToggleLandscape;if(t!=null&&t.parentElement){const i=t.parentElement,l=n.top-e.top-i.offsetHeight-s;i.style.top=`${Math.max(5,l)}px`,i.style.bottom="auto"}const o=this.scoreElements.scoreDisplayLandscape;if(o!=null&&o.parentElement){const i=o.parentElement,l=n.top-e.top-i.offsetHeight-s;i.style.top=`${Math.max(5,l)}px`,i.style.bottom="auto"}}applyDeviceOptimizations(){const e=document.body;if(this.deviceInfo.isIOS){e.classList.add("ios-device"),e.style.overflow="hidden",e.style.position="fixed",e.style.width="100%",e.style.height="100%";const n=document.querySelector('meta[name="viewport"]');n&&n.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover")}this.deviceInfo.isAndroid&&(e.classList.add("android-device"),e.style.transform="translateZ(0)"),this.deviceInfo.isSamsung&&e.classList.add("samsung-browser")}toggleSound(){p.toggleSound(),this.updateSoundButtons()}toggleMusic(){p.toggleMusic(),this.updateMusicButtons()}updateSoundButtons(){const e=p.isSoundEnabled,n=e?"ðŸ”Š":"ðŸ”‡",s=e?"ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð·Ð²ÑƒÐºÐ¾Ð²Ñ‹Ðµ ÑÑ„Ñ„ÐµÐºÑ‚Ñ‹":"Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð·Ð²ÑƒÐºÐ¾Ð²Ñ‹Ðµ ÑÑ„Ñ„ÐµÐºÑ‚Ñ‹";this.buttons.soundToggle&&(this.buttons.soundToggle.textContent=n,this.buttons.soundToggle.title=s),this.buttons.soundToggleLandscape&&(this.buttons.soundToggleLandscape.textContent=n,this.buttons.soundToggleLandscape.title=s)}updateMusicButtons(){const e=p.isMusicEnabled,n=e?"ðŸŽµ":"ðŸ”‡",s=e?"ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ„Ð¾Ð½Ð¾Ð²ÑƒÑŽ Ð¼ÑƒÐ·Ñ‹ÐºÑƒ":"Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ„Ð¾Ð½Ð¾Ð²ÑƒÑŽ Ð¼ÑƒÐ·Ñ‹ÐºÑƒ";this.buttons.musicToggle&&(this.buttons.musicToggle.textContent=n,this.buttons.musicToggle.title=s),this.buttons.musicToggleLandscape&&(this.buttons.musicToggleLandscape.textContent=n,this.buttons.musicToggleLandscape.title=s)}setMusicVolumeFromPercent(e){const n=Math.max(0,Math.min(100,Number(e))),s=n/100;p.setMusicVolume(s),this.volumeControls.musicVolume&&this.volumeControls.musicVolume.value!==e&&(this.volumeControls.musicVolume.value=String(n)),this.volumeControls.musicVolumeLandscape&&this.volumeControls.musicVolumeLandscape.value!==e&&(this.volumeControls.musicVolumeLandscape.value=String(n))}updateScore(e){const n=`Ð¡Ñ‡ÐµÑ‚: ${e}`;this.scoreElements.scoreDisplay&&(this.scoreElements.scoreDisplay.textContent=n),this.scoreElements.scoreDisplayLandscape&&(this.scoreElements.scoreDisplayLandscape.textContent=n)}showHelp(){if(this.elements.helpModal){this.elements.helpModal.classList.remove("hidden"),document.body.style.overflow="hidden",document.body.style.touchAction="auto";const e=this.elements.helpModal.querySelector(".overflow-y-auto");e&&(e.scrollTop=0)}}hideHelp(){this.elements.helpModal&&(this.elements.helpModal.classList.add("hidden"),document.body.style.overflow="",document.body.style.touchAction="none")}get gameArea(){return this.elements.gameArea}get table(){return this.elements.table}get tableContainer(){return this.elements.tableContainer}get cue(){return this.elements.cue}get aimLine(){return this.elements.aimLine}get powerIndicator(){return this.elements.powerIndicator}get powerFill(){return this.elements.powerFill}get pyramidContainer(){return this.elements.pyramidContainer}get resetButton(){return this.buttons.resetButton||null}get resetButtonLandscape(){return this.buttons.resetButtonLandscape||null}get helpModal(){return this.elements.helpModal}get trajectoryCanvas(){return this.elements.trajectoryCanvas}get isMobileDevice(){return this.isMobile}get isPortraitMode(){return this.isPortrait}loadUISettings(){this.updateSoundButtons(),this.updateMusicButtons();const e=Math.round(p.getMusicVolume*100);this.volumeControls.musicVolume&&(this.volumeControls.musicVolume.value=String(e)),this.volumeControls.musicVolumeLandscape&&(this.volumeControls.musicVolumeLandscape.value=String(e))}showGameOver(e,n){if(this.elements.gameOverModal&&(this.elements.gameOverModal.style.display="flex",this.elements.finalScore&&(this.elements.finalScore.textContent=e.toString()),n)){const s=document.getElementById("stat-player-shots"),t=document.getElementById("stat-cat-hits"),o=document.getElementById("stat-fouls");s&&(s.textContent=n.playerShots.toString()),t&&(t.textContent=n.catHits.toString()),o&&(o.textContent=n.foulCount.toString())}}hideGameOver(){this.elements.gameOverModal&&(this.elements.gameOverModal.style.display="none")}};y(E,"UIManager");let b=E;export{b as U};
