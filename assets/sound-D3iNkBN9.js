var E=Object.defineProperty;var u=(h,e)=>E(h,"name",{value:e,configurable:!0});import{A as o,S as d}from"./physics-CneykC2A.js";import{v as T}from"./utils-mddd3nEY.js";const b=class b{constructor(){this.audioContext=null,this.masterGain=null,this.backgroundMusic=null,this.ambientOscillator=null,this.soundEnabled=!0,this.musicEnabled=!0,this.isMusicPlaying=!1,this.musicVolume=o.MUSIC_VOLUME,this.musicTimeout=null,this.scale=[261.63,293.66,329.63,349.23,392,440,493.88,523.25],this.loadSettings()}async initAudio(){if(!this.audioContext)try{const e=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;if(e)if(this.audioContext=new e,this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination),this.masterGain.gain.value=.5,this.audioContext.state==="suspended"){const t=u(()=>{var i;(i=this.audioContext)==null||i.resume().then(()=>{this.startAmbient(),document.removeEventListener("touchstart",t),document.removeEventListener("click",t)})},"resumeAudio");document.addEventListener("touchstart",t,{once:!0}),document.addEventListener("click",t,{once:!0})}else this.startAmbient()}catch{this.audioContext=null}}startAmbient(){if(!(!this.audioContext||!this.soundEnabled||!this.masterGain||this.ambientOscillator))try{const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.type="sine",e.frequency.value=40;const i=this.audioContext.createOscillator();i.frequency.value=.5;const n=this.audioContext.createGain();n.gain.value=5,i.connect(n),n.connect(e.frequency),t.gain.value=.05,e.connect(t),t.connect(this.masterGain),e.start(),i.start(),this.ambientOscillator=e}catch{}}stopAmbient(){if(this.ambientOscillator){try{this.ambientOscillator.stop(),this.ambientOscillator.disconnect()}catch{}this.ambientOscillator=null}}startMusicLoop(){const e=u(()=>{if(!this.musicEnabled||!this.audioContext||!this.masterGain)return;const t=this.audioContext.currentTime,i=this.scale[Math.floor(Math.random()*this.scale.length)],n=this.audioContext.createOscillator(),s=this.audioContext.createGain();n.type="sine",n.frequency.setValueAtTime(i,t),s.gain.setValueAtTime(0,t),s.gain.linearRampToValueAtTime(.05*this.musicVolume,t+.5),s.gain.exponentialRampToValueAtTime(.001,t+3),n.connect(s),s.connect(this.masterGain),n.start(t),n.stop(t+3.1);const l=1500+Math.random()*2e3;this.musicTimeout=window.setTimeout(e,l)},"playNextNote");e()}startBackgroundMusic(){!this.musicEnabled||this.isMusicPlaying||!this.audioContext||(this.isMusicPlaying=!0,this.startMusicLoop())}stopBackgroundMusic(){this.isMusicPlaying=!1,this.musicTimeout!==null&&(clearTimeout(this.musicTimeout),this.musicTimeout=null)}playHitSound(e=10){if(!(!this.audioContext||!this.soundEnabled||!this.masterGain))try{const t=Math.min(Math.max(e,.1)/10,1),i=this.audioContext.createOscillator(),n=this.audioContext.createGain(),s=this.audioContext.createBiquadFilter();i.type="triangle",i.frequency.setValueAtTime(150+Math.random()*50,this.audioContext.currentTime),i.frequency.exponentialRampToValueAtTime(40,this.audioContext.currentTime+.1),s.type="lowpass",s.frequency.value=800,n.gain.setValueAtTime(t*o.SOUND_EFFECT_VOLUME,this.audioContext.currentTime),n.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.15),i.connect(s),s.connect(n),n.connect(this.masterGain),i.start(),i.stop(this.audioContext.currentTime+.2),T(o.VIBRATION_DURATION.HIT)}catch{}}playWallHitSound(e=10){if(!(!this.audioContext||!this.soundEnabled||!this.masterGain))try{const t=Math.min(Math.max(e,.1)/15,.6),i=this.audioContext.createBufferSource(),n=this.audioContext.sampleRate*.1,s=this.audioContext.createBuffer(1,n,this.audioContext.sampleRate),l=s.getChannelData(0);for(let m=0;m<n;m++)l[m]=Math.random()*2-1;i.buffer=s;const r=this.audioContext.createBiquadFilter();r.type="lowpass",r.frequency.value=150;const c=this.audioContext.createGain();c.gain.setValueAtTime(t*o.SOUND_EFFECT_VOLUME,this.audioContext.currentTime),c.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1),i.connect(r),r.connect(c),c.connect(this.masterGain),i.start(),T(o.VIBRATION_DURATION.WALL_HIT)}catch{}}playPocketSound(){if(!(!this.audioContext||!this.soundEnabled||!this.masterGain))try{const e=this.audioContext.currentTime;[440,554,659,880].forEach((t,i)=>{if(!this.audioContext||!this.masterGain)return;const n=this.audioContext.createOscillator(),s=this.audioContext.createGain();n.type="sine",n.frequency.value=t,s.gain.setValueAtTime(0,e+i*.05),s.gain.linearRampToValueAtTime(.2*o.SOUND_EFFECT_VOLUME,e+i*.05+.02),s.gain.exponentialRampToValueAtTime(.01,e+i*.05+.5),n.connect(s),this.masterGain&&s.connect(this.masterGain),n.start(e+i*.05),n.stop(e+i*.05+.6)}),T([50,50,50])}catch{}}playMeowSound(){if(!(!this.audioContext||!this.soundEnabled||!this.masterGain))try{const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.type="square",e.frequency.setValueAtTime(300,this.audioContext.currentTime),e.frequency.linearRampToValueAtTime(800,this.audioContext.currentTime+.1),e.frequency.linearRampToValueAtTime(400,this.audioContext.currentTime+.3),t.gain.setValueAtTime(.1*o.SOUND_EFFECT_VOLUME,this.audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+.3),e.connect(t),t.connect(this.masterGain),e.start(),e.stop(this.audioContext.currentTime+.3),T([...o.VIBRATION_DURATION.MEOW])}catch{}}playPawHit(e){if(!(!this.audioContext||!this.soundEnabled||!this.masterGain))try{const t=this.audioContext.currentTime,i=Math.min(e/15,.8)*o.SOUND_EFFECT_VOLUME,n=this.audioContext.createOscillator(),s=this.audioContext.createGain();n.type="sine",n.frequency.setValueAtTime(80,t),n.frequency.exponentialRampToValueAtTime(40,t+.1),s.gain.setValueAtTime(i,t),s.gain.exponentialRampToValueAtTime(.001,t+.15),n.connect(s),s.connect(this.masterGain),n.start(),n.stop(t+.2);const l=this.audioContext.sampleRate,r=l*.1,c=this.audioContext.createBuffer(1,r,l),m=c.getChannelData(0);for(let C=0;C<r;C++)m[C]=Math.random()*2-1;const x=this.audioContext.createBufferSource();x.buffer=c;const g=this.audioContext.createBiquadFilter();g.type="highpass",g.frequency.value=1e3;const p=this.audioContext.createGain();p.gain.setValueAtTime(i*.3,t),p.gain.exponentialRampToValueAtTime(.001,t+.08),x.connect(g),g.connect(p),p.connect(this.masterGain),x.start()}catch{}}toggleSound(){this.soundEnabled=!this.soundEnabled,this.soundEnabled?this.startAmbient():this.stopAmbient(),this.saveSettings()}toggleMusic(){this.musicEnabled=!this.musicEnabled,this.musicEnabled?this.startBackgroundMusic():this.stopBackgroundMusic(),this.saveSettings()}setMusicVolume(e){var t;this.musicVolume=Math.max(0,Math.min(1,e)),(t=this.backgroundMusic)!=null&&t.gainNode&&this.audioContext&&this.backgroundMusic.gainNode.gain.setTargetAtTime(this.musicVolume,this.audioContext.currentTime,.05),this.saveSettings()}loadSettings(){const e=localStorage.getItem(d.SOUND_ENABLED);e!==null&&(this.soundEnabled=e==="true");const t=localStorage.getItem(d.MUSIC_ENABLED);t!==null&&(this.musicEnabled=t==="true");const i=localStorage.getItem(d.MUSIC_VOLUME);i!==null&&!Number.isNaN(Number(i))&&(this.musicVolume=Math.max(0,Math.min(100,Number(i)))/100)}saveSettings(){localStorage.setItem(d.SOUND_ENABLED,String(this.soundEnabled)),localStorage.setItem(d.MUSIC_ENABLED,String(this.musicEnabled)),localStorage.setItem(d.MUSIC_VOLUME,String(Math.round(this.musicVolume*100)))}get isSoundEnabled(){return this.soundEnabled}get isMusicEnabled(){return this.musicEnabled}get getMusicVolume(){return this.musicVolume}get getIsMusicPlaying(){return this.isMusicPlaying}playCueFall(){if(!(!this.soundEnabled||!this.audioContext||!this.masterGain))try{const e=this.audioContext.currentTime,t=this.audioContext.createOscillator(),i=this.audioContext.createGain();t.type="sine",t.frequency.setValueAtTime(300,e),t.frequency.exponentialRampToValueAtTime(80,e+.4),i.gain.setValueAtTime(.3*o.SOUND_EFFECT_VOLUME,e),i.gain.exponentialRampToValueAtTime(.01,e+.5),t.connect(i),i.connect(this.masterGain),t.start(),t.stop(e+.5),setTimeout(()=>this.playThud(8),350)}catch{}}playThud(e){if(!(!this.soundEnabled||!this.audioContext))try{const t=this.audioContext.currentTime,i=this.audioContext.createOscillator(),n=this.audioContext.createGain();i.type="triangle",i.frequency.setValueAtTime(120,t),i.frequency.exponentialRampToValueAtTime(40,t+.15),n.gain.setValueAtTime(e*.05*o.SOUND_EFFECT_VOLUME,t),n.gain.exponentialRampToValueAtTime(.001,t+.15),i.connect(n),this.masterGain&&n.connect(this.masterGain),i.start(),i.stop(t+.15)}catch{}}};u(b,"SoundManager");let y=b,f=null;function a(){return f||(f=new y),f}u(a,"getSoundManager");const V={get initAudio(){return a().initAudio.bind(a())},get playHitSound(){return a().playHitSound.bind(a())},get playWallHitSound(){return a().playWallHitSound.bind(a())},get playPocketSound(){return a().playPocketSound.bind(a())},get playMeowSound(){return a().playMeowSound.bind(a())},get playPawHit(){return a().playPawHit.bind(a())},get playCueFall(){return a().playCueFall.bind(a())},get toggleSound(){return a().toggleSound.bind(a())},get toggleMusic(){return a().toggleMusic.bind(a())},get setMusicVolume(){return a().setMusicVolume.bind(a())},get startBackgroundMusic(){return a().startBackgroundMusic.bind(a())},get stopBackgroundMusic(){return a().stopBackgroundMusic.bind(a())},get isSoundEnabled(){return a().isSoundEnabled},get isMusicEnabled(){return a().isMusicEnabled},get getMusicVolume(){return a().getMusicVolume},get getIsMusicPlaying(){return a().getIsMusicPlaying}},O=u(h=>a().playHitSound(h),"playHitSound"),G=u(h=>a().playWallHitSound(h),"playWallHitSound"),N=u(()=>a().playPocketSound(),"playPocketSound");export{G as a,O as b,N as p,V as s};
