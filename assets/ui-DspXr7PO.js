var w=Object.defineProperty;var y=(L,e)=>w(L,"name",{value:e,configurable:!0});import{D as r,U as f,a as o}from"./physics-B7sMyJdr.js";import{s as p}from"./sound-BKkSYDmk.js";import{g as v,v as M,d as A}from"./utils-mddd3nEY.js";const S=class S{constructor(){this.elements={},this.buttons={},this.scoreElements={},this.volumeControls={},this.isMobile=!1,this.isPortrait=!1,this.deviceInfo=v(),this.initializeElements(),this.setupEventListeners(),this.checkOrientation(),this.applyDeviceOptimizations()}initializeElements(){this.elements.gameArea=document.querySelector(r.GAME_AREA),this.elements.table=document.querySelector(r.TABLE),this.elements.tableContainer=document.querySelector(r.TABLE_CONTAINER),this.elements.cue=document.querySelector(r.CUE),this.elements.aimLine=document.querySelector(r.AIM_LINE),this.elements.powerIndicator=document.querySelector(r.POWER_INDICATOR),this.elements.powerFill=document.querySelector(r.POWER_FILL),this.elements.pyramidContainer=document.querySelector(r.PYRAMID_CONTAINER),this.elements.helpModal=document.querySelector(r.HELP_MODAL),this.elements.rotationNotice=document.querySelector(r.ROTATION_NOTICE),this.elements.trajectoryCanvas=document.querySelector(r.TRAJECTORY_CANVAS),this.buttons.soundToggle=document.querySelector("#sound-toggle"),this.buttons.musicToggle=document.querySelector("#music-toggle"),this.buttons.helpButton=document.querySelector("#help-button"),this.buttons.resetButton=document.querySelector("#reset-button"),this.buttons.closeHelp=document.querySelector("#close-help"),this.buttons.soundToggleLandscape=document.querySelector("#sound-toggle-landscape"),this.buttons.musicToggleLandscape=document.querySelector("#music-toggle-landscape"),this.buttons.helpButtonLandscape=document.querySelector("#help-button-landscape"),this.buttons.resetButtonLandscape=document.querySelector("#reset-button-landscape"),this.scoreElements.scoreDisplay=document.querySelector(r.SCORE_DISPLAY),this.scoreElements.scoreDisplayLandscape=document.querySelector(r.SCORE_DISPLAY_LANDSCAPE),this.elements.gameOverModal=document.querySelector("#game-over"),this.elements.finalScore=document.querySelector("#final-score"),this.buttons.restartButtonModal=document.querySelector("#restart-button-modal"),this.volumeControls.musicVolume=document.querySelector("#music-volume"),this.volumeControls.musicVolumeLandscape=document.querySelector("#music-volume-landscape")}setupEventListeners(){this.buttons.soundToggle&&this.addButtonListener(this.buttons.soundToggle,()=>this.toggleSound()),this.buttons.musicToggle&&this.addButtonListener(this.buttons.musicToggle,()=>this.toggleMusic()),this.buttons.helpButton&&this.addButtonListener(this.buttons.helpButton,()=>this.showHelp()),this.buttons.closeHelp&&this.addButtonListener(this.buttons.closeHelp,()=>this.hideHelp()),this.buttons.soundToggleLandscape&&this.addButtonListener(this.buttons.soundToggleLandscape,()=>this.toggleSound()),this.buttons.musicToggleLandscape&&this.addButtonListener(this.buttons.musicToggleLandscape,()=>this.toggleMusic()),this.buttons.helpButtonLandscape&&this.addButtonListener(this.buttons.helpButtonLandscape,()=>this.showHelp()),this.buttons.restartButtonModal&&this.addButtonListener(this.buttons.restartButtonModal,()=>{document.dispatchEvent(new CustomEvent("game-reset-requested"))}),this.volumeControls.musicVolume&&this.volumeControls.musicVolume.addEventListener("input",e=>this.setMusicVolumeFromPercent(e.target.value)),this.volumeControls.musicVolumeLandscape&&this.volumeControls.musicVolumeLandscape.addEventListener("input",e=>this.setMusicVolumeFromPercent(e.target.value)),this.setupModalEventListeners(),this.setupKeyboardListeners(),this.setupResizeListeners()}addButtonListener(e,t){e&&(this.deviceInfo.isTouch?(e.addEventListener("touchstart",s=>{s.preventDefault(),s.stopPropagation(),M(30),t()},{passive:!1}),e.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation()})):e.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),t()}),e.addEventListener("touchstart",()=>{e.style.transform="scale(0.95)"},{passive:!0}),e.addEventListener("touchend",()=>{e.style.transform="scale(1)"},{passive:!0}),e.addEventListener("mousedown",()=>{e.style.transform="scale(0.95)"}),e.addEventListener("mouseup",()=>{e.style.transform="scale(1)"}))}setupModalEventListeners(){if(!this.elements.helpModal)return;this.elements.helpModal.addEventListener("click",t=>{t.target===this.elements.helpModal&&this.hideHelp()});const e=this.elements.helpModal.querySelector(".bg-white");e&&(e.addEventListener("click",t=>t.stopPropagation()),e.addEventListener("touchstart",t=>t.stopPropagation()),e.addEventListener("touchmove",t=>{t.target.closest(".overflow-y-auto")||t.preventDefault()},{passive:!1}))}setupKeyboardListeners(){document.addEventListener("keydown",e=>{switch(e.key.toLowerCase()){case"escape":this.hideHelp();break;case"h":this.showHelp();break;case"s":this.toggleSound();break;case"m":this.toggleMusic();break}})}setupResizeListeners(){const e=A(()=>this.handleResize(),f.DEBOUNCE_DELAY);window.addEventListener("resize",e),this.deviceInfo.supportsOrientation&&window.addEventListener("orientationchange",()=>{setTimeout(e,f.ORIENTATION_CHANGE_DELAY)})}handleResize(){this.checkOrientation(),this.updateLayout(),this.positionUIElements()}checkOrientation(){this.isMobile=window.innerWidth<=f.MOBILE_BREAKPOINT,this.isPortrait=window.innerHeight>window.innerWidth,this.elements.rotationNotice&&(this.isMobile&&this.isPortrait?this.elements.rotationNotice.style.display="flex":this.elements.rotationNotice.style.display="none")}updateLayout(){if(!this.elements.gameArea||!this.elements.table||!this.elements.tableContainer)return;const e=this.elements.gameArea.getBoundingClientRect(),t=window.getComputedStyle(this.elements.gameArea),s=parseFloat(t.paddingLeft),i=parseFloat(t.paddingRight),n=parseFloat(t.paddingTop),l=parseFloat(t.paddingBottom),a=e.width-s-i,c=e.height-n-l,h=1.5;let d,u;a/c>h?(u=c,d=u*h):(d=a,u=d/h);const m=20,g=d+m*2,E=u+m*2;this.elements.tableContainer.style.width=`${g}px`,this.elements.tableContainer.style.height=`${E}px`,this.elements.tableContainer.style.left=`${s+(a-g)/2}px`,this.elements.tableContainer.style.top=`${n+(c-E)/2}px`,this.elements.table.style.width=`${d}px`,this.elements.table.style.height=`${u}px`,this.elements.table.style.left=`${m}px`,this.elements.table.style.top=`${m}px`,this.applyDynamicScaling(d,u)}applyDynamicScaling(e,t){const s=e/o.BASE_TABLE_WIDTH,i=t/o.BASE_TABLE_HEIGHT,n=Math.min(s,i);this.scaleCats(n),this.scaleBalls(n),this.scalePockets(n),this.scaleCue(n),this.scaleButtons(n),this.scaleScore(n),this.scalePowerIndicator(n)}scaleCats(e){document.querySelectorAll(".cat-container").forEach(s=>{let i=1;window.innerWidth<=o.BREAKPOINTS.XS?i=o.CAT_SCALES.XS:window.innerWidth<=o.BREAKPOINTS.SM?i=o.CAT_SCALES.SM:window.innerWidth<=o.BREAKPOINTS.MD?i=o.CAT_SCALES.MD:window.innerWidth<=o.BREAKPOINTS.LG?i=o.CAT_SCALES.LG:window.innerWidth<=o.BREAKPOINTS.XL&&(i=o.CAT_SCALES.XL);const n=i*e;s.style.transform=`scale(${Math.max(.05,n)})`})}scaleBalls(e){document.querySelectorAll(".billiard-ball").forEach(s=>{let i=o.BALL_SIZES.BASE;window.innerWidth<=o.BREAKPOINTS.XS?i=o.BALL_SIZES.XS:window.innerWidth<=o.BREAKPOINTS.SM?i=o.BALL_SIZES.SM:window.innerWidth<=o.BREAKPOINTS.MD?i=o.BALL_SIZES.MD:window.innerWidth<=o.BREAKPOINTS.LG&&(i=o.BALL_SIZES.LG);const n=Math.max(.8,e),l=Math.max(3,i*n);s.style.width=`${l}px`,s.style.height=`${l}px`})}scalePockets(e){document.querySelectorAll("[data-pocket]").forEach(s=>{let i=32;window.innerWidth<=o.BREAKPOINTS.XS?i=12:window.innerWidth<=o.BREAKPOINTS.SM?i=14:window.innerWidth<=o.BREAKPOINTS.MD?i=16:window.innerWidth<=o.BREAKPOINTS.LG&&(i=20);const n=Math.max(.8,e),l=Math.max(8,i*n);s.style.width=`${l}px`,s.style.height=`${l}px`})}scaleCue(e){if(!this.elements.cue)return;let t=8,s=40;window.innerWidth<=o.BREAKPOINTS.XS?(t=3,s=10):window.innerWidth<=o.BREAKPOINTS.SM?(t=4,s=15):window.innerWidth<=o.BREAKPOINTS.MD?(t=5,s=20):window.innerWidth<=o.BREAKPOINTS.LG&&(t=6,s=25);const i=Math.max(1,t*e),n=Math.max(5,s);this.elements.cue.style.height=`${i}px`,this.elements.cue.style.width=`${n}%`}scaleButtons(e){document.querySelectorAll("button").forEach(s=>{if(s.closest(".landscape-mobile-controls"))return;let i=16,n=16,l=8,a=40,c=40;window.innerWidth<=o.BREAKPOINTS.SM?(i=8,n=4,l=2,a=12,c=12):window.innerWidth<=o.BREAKPOINTS.MD?(i=10,n=6,l=3,a=16,c=16):window.innerWidth<=o.BREAKPOINTS.LG&&(i=12,n=8,l=4,a=20,c=20);const h=Math.max(6,i*e),d=Math.max(2,n*e),u=Math.max(1,l*e),m=Math.max(10,a*e),g=Math.max(10,c*e);s.style.fontSize=`${h}px`,s.style.padding=`${u}px ${d}px`,s.style.minWidth=`${m}px`,s.style.minHeight=`${g}px`})}scaleScore(e){[{element:this.scoreElements.scoreDisplay,isLandscape:!1},{element:this.scoreElements.scoreDisplayLandscape,isLandscape:!0}].forEach(({element:s,isLandscape:i})=>{if(!s)return;let n=18;if(i){let l=12,a=4;window.innerWidth<=o.BREAKPOINTS.SM&&(n=12);const c=Math.max(8,n*e),h=Math.max(4,l*e),d=Math.max(2,a*e);s.style.fontSize=`${c}px`,s.style.padding=`${d}px ${h}px`}else{window.innerWidth<=o.BREAKPOINTS.SM?n=14:window.innerWidth<=o.BREAKPOINTS.MD?n=20:window.innerWidth<=o.BREAKPOINTS.LG?n=24:n=32;const l=Math.max(16,n*e);s.style.fontSize=`${l}px`,s.style.padding="0",s.style.minWidth="auto"}})}scalePowerIndicator(e){if(!this.elements.powerIndicator)return;let t=200,s=15;window.innerWidth<=o.BREAKPOINTS.XS?(t=40,s=4):window.innerWidth<=o.BREAKPOINTS.SM?(t=50,s=5):window.innerWidth<=o.BREAKPOINTS.MD?(t=80,s=8):window.innerWidth<=o.BREAKPOINTS.LG&&(t=120,s=10);const i=Math.max(30,t*e),n=Math.max(3,s*e);this.elements.powerIndicator.style.width=`${i}px`,this.elements.powerIndicator.style.height=`${n}px`}positionUIElements(){if(!this.elements.gameArea||!this.elements.tableContainer)return;const e=this.elements.gameArea.getBoundingClientRect(),t=this.elements.tableContainer.getBoundingClientRect(),s=Math.min(t.width/o.BASE_TABLE_WIDTH,1.5),i=Math.max(10,20*s);this.positionLeftButtons(e,t,i),this.positionRightElements(e,t,i),this.positionMobileElements(e,t,i)}positionLeftButtons(e,t,s){const i=this.buttons.soundToggle;i!=null&&i.parentElement&&(i.parentElement.style.display="flex",i.parentElement.style.left="",i.parentElement.style.right="")}positionRightElements(e,t,s){const i=this.buttons.resetButton;i!=null&&i.parentElement&&(i.parentElement.style.left="",i.parentElement.style.right="",i.parentElement.style.display="block");const n=this.scoreElements.scoreDisplay;n!=null&&n.parentElement&&(n.parentElement.style.display="block",n.parentElement.style.top="",n.parentElement.style.left="",n.parentElement.style.right="",n.parentElement.style.bottom="")}positionMobileElements(e,t,s){const i=this.buttons.soundToggleLandscape;if(i!=null&&i.parentElement){const l=i.parentElement,a=t.top-e.top-l.offsetHeight-s;l.style.top=`${Math.max(5,a)}px`,l.style.bottom="auto"}const n=this.scoreElements.scoreDisplayLandscape;if(n!=null&&n.parentElement){const l=n.parentElement,a=t.top-e.top-l.offsetHeight-s;l.style.top=`${Math.max(5,a)}px`,l.style.bottom="auto"}}applyDeviceOptimizations(){const e=document.body;if(this.deviceInfo.isIOS){e.classList.add("ios-device"),e.style.overflow="hidden",e.style.position="fixed",e.style.width="100%",e.style.height="100%";const t=document.querySelector('meta[name="viewport"]');t&&t.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover")}this.deviceInfo.isAndroid&&(e.classList.add("android-device"),e.style.transform="translateZ(0)"),this.deviceInfo.isSamsung&&e.classList.add("samsung-browser")}toggleSound(){p.toggleSound(),this.updateSoundButtons()}toggleMusic(){p.toggleMusic(),this.updateMusicButtons()}updateSoundButtons(){const e=p.isSoundEnabled,t=e?"ðŸ”Š":"ðŸ”‡",s=e?"ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð·Ð²ÑƒÐºÐ¾Ð²Ñ‹Ðµ ÑÑ„Ñ„ÐµÐºÑ‚Ñ‹":"Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð·Ð²ÑƒÐºÐ¾Ð²Ñ‹Ðµ ÑÑ„Ñ„ÐµÐºÑ‚Ñ‹";this.buttons.soundToggle&&(this.buttons.soundToggle.textContent=t,this.buttons.soundToggle.title=s),this.buttons.soundToggleLandscape&&(this.buttons.soundToggleLandscape.textContent=t,this.buttons.soundToggleLandscape.title=s)}updateMusicButtons(){const e=p.isMusicEnabled,t=e?"ðŸŽµ":"ðŸ”‡",s=e?"ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ„Ð¾Ð½Ð¾Ð²ÑƒÑŽ Ð¼ÑƒÐ·Ñ‹ÐºÑƒ":"Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ„Ð¾Ð½Ð¾Ð²ÑƒÑŽ Ð¼ÑƒÐ·Ñ‹ÐºÑƒ";this.buttons.musicToggle&&(this.buttons.musicToggle.textContent=t,this.buttons.musicToggle.title=s),this.buttons.musicToggleLandscape&&(this.buttons.musicToggleLandscape.textContent=t,this.buttons.musicToggleLandscape.title=s)}setMusicVolumeFromPercent(e){const t=Math.max(0,Math.min(100,Number(e))),s=t/100;p.setMusicVolume(s),this.volumeControls.musicVolume&&this.volumeControls.musicVolume.value!==e&&(this.volumeControls.musicVolume.value=String(t)),this.volumeControls.musicVolumeLandscape&&this.volumeControls.musicVolumeLandscape.value!==e&&(this.volumeControls.musicVolumeLandscape.value=String(t))}updateScore(e){const t=`Ð¡Ñ‡ÐµÑ‚: ${e}`;this.scoreElements.scoreDisplay&&(this.scoreElements.scoreDisplay.textContent=t),this.scoreElements.scoreDisplayLandscape&&(this.scoreElements.scoreDisplayLandscape.textContent=t)}showHelp(){if(this.elements.helpModal){this.elements.helpModal.classList.remove("hidden"),document.body.style.overflow="hidden",document.body.style.touchAction="auto";const e=this.elements.helpModal.querySelector(".overflow-y-auto");e&&(e.scrollTop=0)}}hideHelp(){this.elements.helpModal&&(this.elements.helpModal.classList.add("hidden"),document.body.style.overflow="",document.body.style.touchAction="none")}get gameArea(){return this.elements.gameArea}get table(){return this.elements.table}get tableContainer(){return this.elements.tableContainer}get cue(){return this.elements.cue}get aimLine(){return this.elements.aimLine}get powerIndicator(){return this.elements.powerIndicator}get powerFill(){return this.elements.powerFill}get pyramidContainer(){return this.elements.pyramidContainer}get resetButton(){return this.buttons.resetButton||null}get resetButtonLandscape(){return this.buttons.resetButtonLandscape||null}get helpModal(){return this.elements.helpModal}get trajectoryCanvas(){return this.elements.trajectoryCanvas}get isMobileDevice(){return this.isMobile}get isPortraitMode(){return this.isPortrait}loadUISettings(){this.updateSoundButtons(),this.updateMusicButtons();const e=Math.round(p.getMusicVolume*100);this.volumeControls.musicVolume&&(this.volumeControls.musicVolume.value=String(e)),this.volumeControls.musicVolumeLandscape&&(this.volumeControls.musicVolumeLandscape.value=String(e))}showGameOver(e,t){if(this.elements.gameOverModal&&(this.elements.gameOverModal.style.display="flex",this.elements.finalScore&&(this.elements.finalScore.textContent=e.toString()),t)){const s=document.getElementById("stat-player-shots"),i=document.getElementById("stat-cat-hits"),n=document.getElementById("stat-fouls");s&&(s.textContent=t.playerShots.toString()),i&&(i.textContent=t.catHits.toString()),n&&(n.textContent=t.foulCount.toString())}}hideGameOver(){this.elements.gameOverModal&&(this.elements.gameOverModal.style.display="none")}};y(S,"UIManager");let b=S;export{b as U};
