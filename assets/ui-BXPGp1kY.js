var M=Object.defineProperty;var y=(L,t)=>M(L,"name",{value:t,configurable:!0});import{D as r,U as g,a as c}from"./physics-CneykC2A.js";import{s as p}from"./sound-D3iNkBN9.js";import{g as v,v as T,d as C}from"./utils-mddd3nEY.js";const f=class f{constructor(){this.elements={},this.buttons={},this.scoreElements={},this.volumeControls={},this.isMobile=!1,this.isPortrait=!1,this.deviceInfo=v(),this.initializeElements(),this.setupEventListeners(),this.checkOrientation(),this.applyDeviceOptimizations()}initializeElements(){this.elements.gameArea=document.querySelector(r.GAME_AREA),this.elements.table=document.querySelector(r.TABLE),this.elements.tableContainer=document.querySelector(r.TABLE_CONTAINER),this.elements.cue=document.querySelector(r.CUE),this.elements.aimLine=document.querySelector(r.AIM_LINE),this.elements.powerIndicator=document.querySelector(r.POWER_INDICATOR),this.elements.powerFill=document.querySelector(r.POWER_FILL),this.elements.pyramidContainer=document.querySelector(r.PYRAMID_CONTAINER),this.elements.helpModal=document.querySelector(r.HELP_MODAL),this.elements.rotationNotice=document.querySelector(r.ROTATION_NOTICE),this.elements.trajectoryCanvas=document.querySelector(r.TRAJECTORY_CANVAS),this.buttons.soundToggle=document.querySelector("#sound-toggle"),this.buttons.musicToggle=document.querySelector("#music-toggle"),this.buttons.helpButton=document.querySelector("#help-button"),this.buttons.resetButton=document.querySelector("#reset-button"),this.buttons.closeHelp=document.querySelector("#close-help"),this.buttons.soundToggleLandscape=document.querySelector("#sound-toggle-landscape"),this.buttons.musicToggleLandscape=document.querySelector("#music-toggle-landscape"),this.buttons.helpButtonLandscape=document.querySelector("#help-button-landscape"),this.buttons.resetButtonLandscape=document.querySelector("#reset-button-landscape"),this.scoreElements.scoreDisplay=document.querySelector(r.SCORE_DISPLAY),this.scoreElements.scoreDisplayLandscape=document.querySelector(r.SCORE_DISPLAY_LANDSCAPE),this.elements.gameOverModal=document.querySelector("#game-over"),this.elements.finalScore=document.querySelector("#final-score"),this.buttons.restartButtonModal=document.querySelector("#restart-button-modal"),this.volumeControls.musicVolume=document.querySelector("#music-volume"),this.volumeControls.musicVolumeLandscape=document.querySelector("#music-volume-landscape")}setupEventListeners(){this.buttons.soundToggle&&this.addButtonListener(this.buttons.soundToggle,()=>this.toggleSound()),this.buttons.musicToggle&&this.addButtonListener(this.buttons.musicToggle,()=>this.toggleMusic()),this.buttons.helpButton&&this.addButtonListener(this.buttons.helpButton,()=>this.showHelp()),this.buttons.closeHelp&&this.addButtonListener(this.buttons.closeHelp,()=>this.hideHelp()),this.buttons.soundToggleLandscape&&this.addButtonListener(this.buttons.soundToggleLandscape,()=>this.toggleSound()),this.buttons.musicToggleLandscape&&this.addButtonListener(this.buttons.musicToggleLandscape,()=>this.toggleMusic()),this.buttons.helpButtonLandscape&&this.addButtonListener(this.buttons.helpButtonLandscape,()=>this.showHelp()),this.buttons.restartButtonModal&&this.addButtonListener(this.buttons.restartButtonModal,()=>{document.dispatchEvent(new CustomEvent("game-reset-requested"))}),this.volumeControls.musicVolume&&this.volumeControls.musicVolume.addEventListener("input",t=>this.setMusicVolumeFromPercent(t.target.value)),this.volumeControls.musicVolumeLandscape&&this.volumeControls.musicVolumeLandscape.addEventListener("input",t=>this.setMusicVolumeFromPercent(t.target.value)),this.setupModalEventListeners(),this.setupKeyboardListeners(),this.setupResizeListeners()}addButtonListener(t,s){t&&(this.deviceInfo.isTouch?(t.addEventListener("touchstart",e=>{e.preventDefault(),e.stopPropagation(),T(30),s()},{passive:!1}),t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation()})):t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),s()}),t.addEventListener("touchstart",()=>{t.style.transform="scale(0.95)"},{passive:!0}),t.addEventListener("touchend",()=>{t.style.transform="scale(1)"},{passive:!0}),t.addEventListener("mousedown",()=>{t.style.transform="scale(0.95)"}),t.addEventListener("mouseup",()=>{t.style.transform="scale(1)"}))}setupModalEventListeners(){if(!this.elements.helpModal)return;this.elements.helpModal.addEventListener("click",s=>{s.target===this.elements.helpModal&&this.hideHelp()});const t=this.elements.helpModal.querySelector(".bg-white");t&&(t.addEventListener("click",s=>s.stopPropagation()),t.addEventListener("touchstart",s=>s.stopPropagation()),t.addEventListener("touchmove",s=>{s.target.closest(".overflow-y-auto")||s.preventDefault()},{passive:!1}))}setupKeyboardListeners(){document.addEventListener("keydown",t=>{switch(t.key.toLowerCase()){case"escape":this.hideHelp();break;case"h":this.showHelp();break;case"s":this.toggleSound();break;case"m":this.toggleMusic();break}})}setupResizeListeners(){const t=C(()=>this.handleResize(),g.DEBOUNCE_DELAY);window.addEventListener("resize",t),this.deviceInfo.supportsOrientation&&window.addEventListener("orientationchange",()=>{setTimeout(t,g.ORIENTATION_CHANGE_DELAY)})}handleResize(){this.checkOrientation(),this.updateLayout(),this.positionUIElements()}checkOrientation(){this.isMobile=window.innerWidth<=g.MOBILE_BREAKPOINT,this.isPortrait=window.innerHeight>window.innerWidth,this.elements.rotationNotice&&(this.isMobile&&this.isPortrait?this.elements.rotationNotice.style.display="flex":this.elements.rotationNotice.style.display="none")}updateLayout(){if(!this.elements.gameArea||!this.elements.table||!this.elements.tableContainer)return;const t=this.elements.gameArea.getBoundingClientRect(),s=window.getComputedStyle(this.elements.gameArea),e=parseFloat(s.paddingLeft),o=parseFloat(s.paddingRight),n=parseFloat(s.paddingTop),i=parseFloat(s.paddingBottom),l=t.width-e-o,a=t.height-n-i,d=1.5;let u,h;l/a>d?(h=a,u=h*d):(u=l,h=u/d);const m=20,E=u+m*2,S=h+m*2;this.elements.tableContainer.style.width=`${E}px`,this.elements.tableContainer.style.height=`${S}px`,this.elements.tableContainer.style.left=`${e+(l-E)/2}px`,this.elements.tableContainer.style.top=`${n+(a-S)/2}px`,this.elements.table.style.width=`${u}px`,this.elements.table.style.height=`${h}px`,this.elements.table.style.left=`${m}px`,this.elements.table.style.top=`${m}px`,this.applyDynamicScaling(u,h)}applyDynamicScaling(t,s){const e=t/c.BASE_TABLE_WIDTH,o=s/c.BASE_TABLE_HEIGHT,n=Math.min(e,o);this.scaleCats(n),this.scaleBalls(n),this.scalePockets(n),this.scaleCue(n),this.scaleButtons(n),this.scaleScore(n),this.scalePowerIndicator(n)}scaleCats(t){const s=document.querySelectorAll(".cat-container"),{BREAKPOINTS:e,CAT_SCALES:o}=c;let n=o.BASE;const i=window.innerWidth;i<=e.SM?n=o.SM:i<=e.MD?n=o.MD:i<=e.LG&&(n=o.LG),s.forEach(l=>{const a=n*Math.max(.8,t);l.style.transform=`scale(${Math.max(.1,a)})`})}scaleBalls(t){const s=document.querySelectorAll(".billiard-ball"),{BREAKPOINTS:e,BALL_SIZES:o}=c;let n=o.BASE;const i=window.innerWidth;i<=e.SM?n=o.SM:i<=e.MD?n=o.MD:i<=e.LG&&(n=o.LG),s.forEach(l=>{const a=Math.max(8,n*t);l.style.width=`${a}px`,l.style.height=`${a}px`})}scalePockets(t){const s=document.querySelectorAll("[data-pocket]"),{BREAKPOINTS:e,POCKET_SIZES:o}=c;let n=o.BASE;const i=window.innerWidth;i<=e.SM?n=o.SM:i<=e.MD?n=o.MD:i<=e.LG&&(n=o.LG),s.forEach(l=>{const a=Math.max(12,n*t);l.style.width=`${a}px`,l.style.height=`${a}px`})}scaleCue(t){if(!this.elements.cue)return;const{BREAKPOINTS:s,CUE_SIZES:e}=c;let o=e.HEIGHT.BASE,n=e.WIDTH_PERCENT.BASE;const i=window.innerWidth;i<=s.SM?(o=e.HEIGHT.SM,n=e.WIDTH_PERCENT.SM):i<=s.MD?(o=e.HEIGHT.MD,n=e.WIDTH_PERCENT.MD):i<=s.LG&&(o=e.HEIGHT.LG,n=e.WIDTH_PERCENT.LG);const l=Math.max(2,o*t);this.elements.cue.style.height=`${l}px`,this.elements.cue.style.width=`${n}%`}scaleButtons(t){const s=document.querySelectorAll("button"),{BREAKPOINTS:e,BUTTON_SIZES:o}=c;let n=o.FONT.BASE,i=o.PADDING_X.BASE,l=o.PADDING_Y.BASE;const a=window.innerWidth;a<=e.SM?(n=o.FONT.SM,i=o.PADDING_X.SM,l=o.PADDING_Y.SM):a<=e.MD?(n=o.FONT.MD,i=o.PADDING_X.MD,l=o.PADDING_Y.MD):a<=e.LG&&(n=o.FONT.LG,i=o.PADDING_X.LG,l=o.PADDING_Y.LG),s.forEach(d=>{if(d.closest(".landscape-mobile-controls"))return;const u=Math.max(8,n*t),h=Math.max(4,i*t),m=Math.max(2,l*t);d.style.fontSize=`${u}px`,d.style.padding=`${m}px ${h}px`})}scaleScore(t){const s=[this.scoreElements.scoreDisplay,this.scoreElements.scoreDisplayLandscape],{BREAKPOINTS:e,SCORE_SIZES:o}=c;let n=o.FONT.BASE;const i=window.innerWidth;i<=e.SM?n=o.FONT.SM:i<=e.MD?n=o.FONT.MD:i<=e.LG&&(n=o.FONT.LG),s.forEach(l=>{if(!l)return;const a=Math.max(12,n*t);l.style.fontSize=`${a}px`})}scalePowerIndicator(t){if(!this.elements.powerIndicator)return;const{BREAKPOINTS:s,POWER_INDICATOR_SIZES:e}=c;let o=e.WIDTH.BASE,n=e.HEIGHT.BASE;const i=window.innerWidth;i<=s.SM?(o=e.WIDTH.SM,n=e.HEIGHT.SM):i<=s.MD?(o=e.WIDTH.MD,n=e.HEIGHT.MD):i<=s.LG&&(o=e.WIDTH.LG,n=e.HEIGHT.LG);const l=Math.max(50,o*t),a=Math.max(5,n*t);this.elements.powerIndicator.style.width=`${l}px`,this.elements.powerIndicator.style.height=`${a}px`}positionUIElements(){if(!this.elements.gameArea||!this.elements.tableContainer)return;const t=this.elements.gameArea.getBoundingClientRect(),s=this.elements.tableContainer.getBoundingClientRect(),e=Math.min(s.width/c.BASE_TABLE_WIDTH,1.5),o=Math.max(10,20*e);this.positionLeftButtons(t,s,o),this.positionRightElements(t,s,o),this.positionMobileElements(t,s,o)}positionLeftButtons(t,s,e){const o=this.buttons.soundToggle;o!=null&&o.parentElement&&(o.parentElement.style.display="flex",o.parentElement.style.left="",o.parentElement.style.right="")}positionRightElements(t,s,e){const o=this.buttons.resetButton;if(!(o!=null&&o.parentElement))return;const n=o.parentElement,i=s.right-t.left+e,l=Math.min(i,t.width-n.offsetWidth-e);n.style.position="absolute",n.style.left=`${l}px`,n.style.top=`${s.top+s.height/2-n.offsetHeight/2}px`,n.style.right="auto"}positionMobileElements(t,s,e){const o=this.buttons.soundToggleLandscape;if(o!=null&&o.parentElement){const i=o.parentElement,l=s.top-t.top-i.offsetHeight-e;i.style.top=`${Math.max(5,l)}px`,i.style.bottom="auto"}const n=this.scoreElements.scoreDisplayLandscape;if(n!=null&&n.parentElement){const i=n.parentElement,l=s.top-t.top-i.offsetHeight-e;i.style.top=`${Math.max(5,l)}px`,i.style.bottom="auto"}}applyDeviceOptimizations(){const t=document.body;if(this.deviceInfo.isIOS){t.classList.add("ios-device"),t.style.overflow="hidden",t.style.position="fixed",t.style.width="100%",t.style.height="100%";const s=document.querySelector('meta[name="viewport"]');s&&s.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover")}this.deviceInfo.isAndroid&&(t.classList.add("android-device"),t.style.transform="translateZ(0)"),this.deviceInfo.isSamsung&&t.classList.add("samsung-browser")}toggleSound(){p.toggleSound(),this.updateSoundButtons()}toggleMusic(){p.toggleMusic(),this.updateMusicButtons()}updateSoundButtons(){const t=p.isSoundEnabled,s=t?"ðŸ”Š":"ðŸ”‡",e=t?"ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð·Ð²ÑƒÐºÐ¾Ð²Ñ‹Ðµ ÑÑ„Ñ„ÐµÐºÑ‚Ñ‹":"Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð·Ð²ÑƒÐºÐ¾Ð²Ñ‹Ðµ ÑÑ„Ñ„ÐµÐºÑ‚Ñ‹";this.buttons.soundToggle&&(this.buttons.soundToggle.textContent=s,this.buttons.soundToggle.title=e),this.buttons.soundToggleLandscape&&(this.buttons.soundToggleLandscape.textContent=s,this.buttons.soundToggleLandscape.title=e)}updateMusicButtons(){const t=p.isMusicEnabled,s=t?"ðŸŽµ":"ðŸ”‡",e=t?"ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ„Ð¾Ð½Ð¾Ð²ÑƒÑŽ Ð¼ÑƒÐ·Ñ‹ÐºÑƒ":"Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ„Ð¾Ð½Ð¾Ð²ÑƒÑŽ Ð¼ÑƒÐ·Ñ‹ÐºÑƒ";this.buttons.musicToggle&&(this.buttons.musicToggle.textContent=s,this.buttons.musicToggle.title=e),this.buttons.musicToggleLandscape&&(this.buttons.musicToggleLandscape.textContent=s,this.buttons.musicToggleLandscape.title=e)}setMusicVolumeFromPercent(t){const s=Math.max(0,Math.min(100,Number(t))),e=s/100;p.setMusicVolume(e),this.volumeControls.musicVolume&&this.volumeControls.musicVolume.value!==t&&(this.volumeControls.musicVolume.value=String(s)),this.volumeControls.musicVolumeLandscape&&this.volumeControls.musicVolumeLandscape.value!==t&&(this.volumeControls.musicVolumeLandscape.value=String(s))}updateScore(t){const s=`Ð¡Ñ‡ÐµÑ‚: ${t}`;this.scoreElements.scoreDisplay&&(this.scoreElements.scoreDisplay.textContent=s),this.scoreElements.scoreDisplayLandscape&&(this.scoreElements.scoreDisplayLandscape.textContent=s)}showHelp(){if(this.elements.helpModal){this.elements.helpModal.classList.remove("hidden"),document.body.style.overflow="hidden",document.body.style.touchAction="auto";const t=this.elements.helpModal.querySelector(".overflow-y-auto");t&&(t.scrollTop=0)}}hideHelp(){this.elements.helpModal&&(this.elements.helpModal.classList.add("hidden"),document.body.style.overflow="",document.body.style.touchAction="none")}get gameArea(){return this.elements.gameArea}get table(){return this.elements.table}get tableContainer(){return this.elements.tableContainer}get cue(){return this.elements.cue}get aimLine(){return this.elements.aimLine}get powerIndicator(){return this.elements.powerIndicator}get powerFill(){return this.elements.powerFill}get pyramidContainer(){return this.elements.pyramidContainer}get resetButton(){return this.buttons.resetButton||null}get resetButtonLandscape(){return this.buttons.resetButtonLandscape||null}get helpModal(){return this.elements.helpModal}get trajectoryCanvas(){return this.elements.trajectoryCanvas}get isMobileDevice(){return this.isMobile}get isPortraitMode(){return this.isPortrait}loadUISettings(){this.updateSoundButtons(),this.updateMusicButtons();const t=Math.round(p.getMusicVolume*100);this.volumeControls.musicVolume&&(this.volumeControls.musicVolume.value=String(t)),this.volumeControls.musicVolumeLandscape&&(this.volumeControls.musicVolumeLandscape.value=String(t))}showGameOver(t,s){if(this.elements.gameOverModal&&(this.elements.gameOverModal.style.display="flex",this.elements.finalScore&&(this.elements.finalScore.textContent=t.toString()),s)){const e=document.getElementById("stat-player-shots"),o=document.getElementById("stat-cat-hits"),n=document.getElementById("stat-fouls");e&&(e.textContent=s.playerShots.toString()),o&&(o.textContent=s.catHits.toString()),n&&(n.textContent=s.foulCount.toString())}}hideGameOver(){this.elements.gameOverModal&&(this.elements.gameOverModal.style.display="none")}};y(f,"UIManager");let b=f;export{b as U};
