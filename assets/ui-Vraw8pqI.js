var M=Object.defineProperty;var b=(L,e)=>M(L,"name",{value:e,configurable:!0});import{D as r,U as g,a as c}from"./physics-Cwab0H-q.js";import{s as p}from"./sound-Bv0E3ubS.js";import{g as v,v as T,d as C}from"./utils-mddd3nEY.js";const S=class S{constructor(){this.elements={},this.buttons={},this.scoreElements={},this.volumeControls={},this.isMobile=!1,this.isPortrait=!1,this.deviceInfo=v(),this.initializeElements(),this.setupEventListeners(),this.checkOrientation(),this.applyDeviceOptimizations()}initializeElements(){this.elements.gameArea=document.querySelector(r.GAME_AREA),this.elements.table=document.querySelector(r.TABLE),this.elements.tableContainer=document.querySelector(r.TABLE_CONTAINER),this.elements.cue=document.querySelector(r.CUE),this.elements.aimLine=document.querySelector(r.AIM_LINE),this.elements.powerIndicator=document.querySelector(r.POWER_INDICATOR),this.elements.powerFill=document.querySelector(r.POWER_FILL),this.elements.pyramidContainer=document.querySelector(r.PYRAMID_CONTAINER),this.elements.helpModal=document.querySelector(r.HELP_MODAL),this.elements.rotationNotice=document.querySelector(r.ROTATION_NOTICE),this.elements.trajectoryCanvas=document.querySelector(r.TRAJECTORY_CANVAS),this.buttons.soundToggle=document.querySelector("#sound-toggle"),this.buttons.musicToggle=document.querySelector("#music-toggle"),this.buttons.helpButton=document.querySelector("#help-button"),this.buttons.resetButton=document.querySelector("#reset-button"),this.buttons.closeHelp=document.querySelector("#close-help"),this.buttons.soundToggleLandscape=document.querySelector("#sound-toggle-landscape"),this.buttons.musicToggleLandscape=document.querySelector("#music-toggle-landscape"),this.buttons.helpButtonLandscape=document.querySelector("#help-button-landscape"),this.buttons.resetButtonLandscape=document.querySelector("#reset-button-landscape"),this.scoreElements.scoreDisplay=document.querySelector(r.SCORE_DISPLAY),this.scoreElements.scoreDisplayLandscape=document.querySelector(r.SCORE_DISPLAY_LANDSCAPE),this.elements.gameOverModal=document.querySelector("#game-over"),this.elements.finalScore=document.querySelector("#final-score"),this.buttons.restartButtonModal=document.querySelector("#restart-button-modal"),this.volumeControls.musicVolume=document.querySelector("#music-volume"),this.volumeControls.musicVolumeLandscape=document.querySelector("#music-volume-landscape"),this.elements.mainRightButtonsContainer=document.querySelector("#main-right-buttons-container"),this.elements.mainScoreContainer=document.querySelector("#main-score-container")}setupEventListeners(){this.buttons.soundToggle&&this.addButtonListener(this.buttons.soundToggle,()=>this.toggleSound()),this.buttons.musicToggle&&this.addButtonListener(this.buttons.musicToggle,()=>this.toggleMusic()),this.buttons.helpButton&&this.addButtonListener(this.buttons.helpButton,()=>this.showHelp()),this.buttons.closeHelp&&this.addButtonListener(this.buttons.closeHelp,()=>this.hideHelp()),this.buttons.soundToggleLandscape&&this.addButtonListener(this.buttons.soundToggleLandscape,()=>this.toggleSound()),this.buttons.musicToggleLandscape&&this.addButtonListener(this.buttons.musicToggleLandscape,()=>this.toggleMusic()),this.buttons.helpButtonLandscape&&this.addButtonListener(this.buttons.helpButtonLandscape,()=>this.showHelp()),this.buttons.restartButtonModal&&this.addButtonListener(this.buttons.restartButtonModal,()=>{document.dispatchEvent(new CustomEvent("game-reset-requested"))}),this.volumeControls.musicVolume&&this.volumeControls.musicVolume.addEventListener("input",e=>this.setMusicVolumeFromPercent(e.target.value)),this.volumeControls.musicVolumeLandscape&&this.volumeControls.musicVolumeLandscape.addEventListener("input",e=>this.setMusicVolumeFromPercent(e.target.value)),this.setupModalEventListeners(),this.setupKeyboardListeners(),this.setupResizeListeners()}addButtonListener(e,s){e&&(this.deviceInfo.isTouch?(e.addEventListener("touchstart",t=>{t.preventDefault(),t.stopPropagation(),T(30),s()},{passive:!1}),e.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation()})):e.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),s()}),e.addEventListener("touchstart",()=>{e.style.transform="scale(0.95)"},{passive:!0}),e.addEventListener("touchend",()=>{e.style.transform="scale(1)"},{passive:!0}),e.addEventListener("mousedown",()=>{e.style.transform="scale(0.95)"}),e.addEventListener("mouseup",()=>{e.style.transform="scale(1)"}))}setupModalEventListeners(){if(!this.elements.helpModal)return;this.elements.helpModal.addEventListener("click",s=>{s.target===this.elements.helpModal&&this.hideHelp()});const e=this.elements.helpModal.querySelector(".bg-white");e&&(e.addEventListener("click",s=>s.stopPropagation()),e.addEventListener("touchstart",s=>s.stopPropagation()),e.addEventListener("touchmove",s=>{s.target.closest(".overflow-y-auto")||s.preventDefault()},{passive:!1}))}setupKeyboardListeners(){document.addEventListener("keydown",e=>{switch(e.key.toLowerCase()){case"escape":this.hideHelp();break;case"h":this.showHelp();break;case"s":this.toggleSound();break;case"m":this.toggleMusic();break}})}setupResizeListeners(){const e=C(()=>this.handleResize(),g.DEBOUNCE_DELAY);window.addEventListener("resize",e),this.deviceInfo.supportsOrientation&&window.addEventListener("orientationchange",()=>{setTimeout(e,g.ORIENTATION_CHANGE_DELAY)})}handleResize(){this.checkOrientation(),this.updateLayout(),this.positionUIElements()}checkOrientation(){this.isMobile=window.innerWidth<=g.MOBILE_BREAKPOINT,this.isPortrait=window.innerHeight>window.innerWidth,this.elements.rotationNotice&&(this.isMobile&&this.isPortrait?this.elements.rotationNotice.style.display="flex":this.elements.rotationNotice.style.display="none")}updateLayout(){if(!this.elements.gameArea||!this.elements.table||!this.elements.tableContainer)return;const e=this.elements.gameArea.getBoundingClientRect(),s=window.getComputedStyle(this.elements.gameArea),t=parseFloat(s.paddingLeft),i=parseFloat(s.paddingRight),o=parseFloat(s.paddingTop),n=parseFloat(s.paddingBottom),l=e.width-t-i,a=e.height-o-n,h=1.5;let u,d;l/a>h?(d=a,u=d*h):(u=l,d=u/h);const m=20,f=u+m*2,E=d+m*2;this.elements.tableContainer.style.width=`${f}px`,this.elements.tableContainer.style.height=`${E}px`,this.elements.tableContainer.style.left=`${t+(l-f)/2}px`,this.elements.tableContainer.style.top=`${o+(a-E)/2}px`,this.elements.table.style.width=`${u}px`,this.elements.table.style.height=`${d}px`,this.elements.table.style.left=`${m}px`,this.elements.table.style.top=`${m}px`,this.applyDynamicScaling(u,d)}applyDynamicScaling(e,s){const t=e/c.BASE_TABLE_WIDTH,i=s/c.BASE_TABLE_HEIGHT,o=Math.min(t,i);this.scaleCats(o),this.scaleBalls(o),this.scalePockets(o),this.scaleCue(o),this.scaleButtons(o),this.scaleScore(o),this.scalePowerIndicator(o)}scaleCats(e){const s=document.querySelectorAll(".cat-container"),{BREAKPOINTS:t,CAT_SCALES:i}=c;let o=i.BASE;const n=window.innerWidth;n<=t.SM?o=i.SM:n<=t.MD?o=i.MD:n<=t.LG&&(o=i.LG),s.forEach(l=>{const a=o*Math.max(.8,e);l.style.transform=`scale(${Math.max(.1,a)})`})}scaleBalls(e){const s=document.querySelectorAll(".billiard-ball"),{BREAKPOINTS:t,BALL_SIZES:i}=c;let o=i.BASE;const n=window.innerWidth;n<=t.SM?o=i.SM:n<=t.MD?o=i.MD:n<=t.LG&&(o=i.LG),s.forEach(l=>{const a=Math.max(8,o*e);l.style.width=`${a}px`,l.style.height=`${a}px`})}scalePockets(e){const s=document.querySelectorAll("[data-pocket]"),{BREAKPOINTS:t,POCKET_SIZES:i}=c;let o=i.BASE;const n=window.innerWidth;n<=t.SM?o=i.SM:n<=t.MD?o=i.MD:n<=t.LG&&(o=i.LG),s.forEach(l=>{const a=Math.max(12,o*e);l.style.width=`${a}px`,l.style.height=`${a}px`})}scaleCue(e){if(!this.elements.cue)return;const{BREAKPOINTS:s,CUE_SIZES:t}=c;let i=t.HEIGHT.BASE,o=t.WIDTH_PERCENT.BASE;const n=window.innerWidth;n<=s.SM?(i=t.HEIGHT.SM,o=t.WIDTH_PERCENT.SM):n<=s.MD?(i=t.HEIGHT.MD,o=t.WIDTH_PERCENT.MD):n<=s.LG&&(i=t.HEIGHT.LG,o=t.WIDTH_PERCENT.LG);const l=Math.max(2,i*e);this.elements.cue.style.height=`${l}px`,this.elements.cue.style.width=`${o}%`}scaleButtons(e){const s=document.querySelectorAll("button"),{BREAKPOINTS:t,BUTTON_SIZES:i}=c;let o=i.FONT.BASE,n=i.PADDING_X.BASE,l=i.PADDING_Y.BASE;const a=window.innerWidth;a<=t.SM?(o=i.FONT.SM,n=i.PADDING_X.SM,l=i.PADDING_Y.SM):a<=t.MD?(o=i.FONT.MD,n=i.PADDING_X.MD,l=i.PADDING_Y.MD):a<=t.LG&&(o=i.FONT.LG,n=i.PADDING_X.LG,l=i.PADDING_Y.LG),s.forEach(h=>{if(h.closest(".landscape-mobile-controls"))return;const u=Math.max(8,o*e),d=Math.max(4,n*e),m=Math.max(2,l*e);h.style.fontSize=`${u}px`,h.style.padding=`${m}px ${d}px`})}scaleScore(e){const s=[this.scoreElements.scoreDisplay,this.scoreElements.scoreDisplayLandscape],{BREAKPOINTS:t,SCORE_SIZES:i}=c;let o=i.FONT.BASE;const n=window.innerWidth;n<=t.SM?o=i.FONT.SM:n<=t.MD?o=i.FONT.MD:n<=t.LG&&(o=i.FONT.LG),s.forEach(l=>{if(!l)return;const a=Math.max(12,o*e);l.style.fontSize=`${a}px`})}scalePowerIndicator(e){if(!this.elements.powerIndicator)return;const{BREAKPOINTS:s,POWER_INDICATOR_SIZES:t}=c;let i=t.WIDTH.BASE,o=t.HEIGHT.BASE;const n=window.innerWidth;n<=s.SM?(i=t.WIDTH.SM,o=t.HEIGHT.SM):n<=s.MD?(i=t.WIDTH.MD,o=t.HEIGHT.MD):n<=s.LG&&(i=t.WIDTH.LG,o=t.HEIGHT.LG);const l=Math.max(50,i*e),a=Math.max(5,o*e);this.elements.powerIndicator.style.width=`${l}px`,this.elements.powerIndicator.style.height=`${a}px`}positionUIElements(){if(!this.elements.gameArea||!this.elements.tableContainer)return;const e=this.elements.gameArea.getBoundingClientRect(),s=this.elements.tableContainer.getBoundingClientRect(),t=Math.min(s.width/c.BASE_TABLE_WIDTH,1.5),i=Math.max(10,20*t);this.positionLeftButtons(e,s,i),this.positionRightElements(e,s,i),this.positionMobileElements(e,s,i)}positionLeftButtons(e,s,t){}positionRightElements(e,s,t){}positionMobileElements(e,s,t){}applyDeviceOptimizations(){const e=document.body;if(this.deviceInfo.isIOS){e.classList.add("ios-device"),e.style.overflow="hidden",e.style.position="fixed",e.style.width="100%",e.style.height="100%";const s=document.querySelector('meta[name="viewport"]');s&&s.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover")}this.deviceInfo.isAndroid&&(e.classList.add("android-device"),e.style.transform="translateZ(0)"),this.deviceInfo.isSamsung&&e.classList.add("samsung-browser")}toggleSound(){p.toggleSound(),this.updateSoundButtons()}toggleMusic(){p.toggleMusic(),this.updateMusicButtons()}updateSoundButtons(){const e=p.isSoundEnabled,s=e?"ðŸ”Š":"ðŸ”‡",t=e?"ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð·Ð²ÑƒÐºÐ¾Ð²Ñ‹Ðµ ÑÑ„Ñ„ÐµÐºÑ‚Ñ‹":"Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð·Ð²ÑƒÐºÐ¾Ð²Ñ‹Ðµ ÑÑ„Ñ„ÐµÐºÑ‚Ñ‹";this.buttons.soundToggle&&(this.buttons.soundToggle.textContent=s,this.buttons.soundToggle.title=t),this.buttons.soundToggleLandscape&&(this.buttons.soundToggleLandscape.textContent=s,this.buttons.soundToggleLandscape.title=t)}updateMusicButtons(){const e=p.isMusicEnabled,s=e?"ðŸŽµ":"ðŸ”‡",t=e?"ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ„Ð¾Ð½Ð¾Ð²ÑƒÑŽ Ð¼ÑƒÐ·Ñ‹ÐºÑƒ":"Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ„Ð¾Ð½Ð¾Ð²ÑƒÑŽ Ð¼ÑƒÐ·Ñ‹ÐºÑƒ";this.buttons.musicToggle&&(this.buttons.musicToggle.textContent=s,this.buttons.musicToggle.title=t),this.buttons.musicToggleLandscape&&(this.buttons.musicToggleLandscape.textContent=s,this.buttons.musicToggleLandscape.title=t)}setMusicVolumeFromPercent(e){const s=Math.max(0,Math.min(100,Number(e))),t=s/100;p.setMusicVolume(t),this.volumeControls.musicVolume&&this.volumeControls.musicVolume.value!==e&&(this.volumeControls.musicVolume.value=String(s)),this.volumeControls.musicVolumeLandscape&&this.volumeControls.musicVolumeLandscape.value!==e&&(this.volumeControls.musicVolumeLandscape.value=String(s))}updateScore(e){const s=`Ð¡Ñ‡ÐµÑ‚: ${e}`;this.scoreElements.scoreDisplay&&(this.scoreElements.scoreDisplay.textContent=s),this.scoreElements.scoreDisplayLandscape&&(this.scoreElements.scoreDisplayLandscape.textContent=s)}showHelp(){if(this.elements.helpModal){this.elements.helpModal.classList.remove("hidden"),document.body.style.overflow="hidden",document.body.style.touchAction="auto";const e=this.elements.helpModal.querySelector(".overflow-y-auto");e&&(e.scrollTop=0)}}hideHelp(){this.elements.helpModal&&(this.elements.helpModal.classList.add("hidden"),document.body.style.overflow="",document.body.style.touchAction="none")}get gameArea(){return this.elements.gameArea}get table(){return this.elements.table}get tableContainer(){return this.elements.tableContainer}get cue(){return this.elements.cue}get aimLine(){return this.elements.aimLine}get powerIndicator(){return this.elements.powerIndicator}get powerFill(){return this.elements.powerFill}get pyramidContainer(){return this.elements.pyramidContainer}get resetButton(){return this.buttons.resetButton||null}get resetButtonLandscape(){return this.buttons.resetButtonLandscape||null}get helpModal(){return this.elements.helpModal}get trajectoryCanvas(){return this.elements.trajectoryCanvas}get isMobileDevice(){return this.isMobile}get isPortraitMode(){return this.isPortrait}loadUISettings(){this.updateSoundButtons(),this.updateMusicButtons();const e=Math.round(p.getMusicVolume*100);this.volumeControls.musicVolume&&(this.volumeControls.musicVolume.value=String(e)),this.volumeControls.musicVolumeLandscape&&(this.volumeControls.musicVolumeLandscape.value=String(e))}showGameOver(e,s){if(this.elements.gameOverModal&&(this.elements.gameOverModal.style.display="flex",this.elements.finalScore&&(this.elements.finalScore.textContent=e.toString()),s)){const t=document.getElementById("stat-player-shots"),i=document.getElementById("stat-cat-hits"),o=document.getElementById("stat-fouls");t&&(t.textContent=s.playerShots.toString()),i&&(i.textContent=s.catHits.toString()),o&&(o.textContent=s.foulCount.toString())}}hideGameOver(){this.elements.gameOverModal&&(this.elements.gameOverModal.style.display="none")}};b(S,"UIManager");let y=S;export{y as U};
