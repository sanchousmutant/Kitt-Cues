(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))r(u);new MutationObserver(u=>{for(const i of u)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(u){const i={};return u.integrity&&(i.integrity=u.integrity),u.referrerPolicy&&(i.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?i.credentials="include":u.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(u){if(u.ep)return;u.ep=!0;const i=t(u);fetch(u.href,i)}})();function nt(a=window,o=document){const t=o.getElementById("game-area"),r=o.getElementById("billiard-table"),u=o.getElementById("cue"),i=o.getElementById("aim-line"),l=o.getElementById("power-indicator"),b=o.getElementById("power-fill"),R=o.getElementById("ball-pyramid"),x={gameArea:t,table:r,cue:u,aimLine:i,powerIndicator:l,powerFill:b,pyramidContainer:R},X={friction:.985,minVelocity:.05,hitPower:15,pawHitPower:4,catCooldown:60,balls:[],cats:[],pockets:[],score:0,animationFrameId:null,cueAngle:0,isDragging:!1,dragStartX:0,dragStartY:0,audioContext:null,soundEnabled:!0,musicEnabled:!0,backgroundMusic:null,isMusicPlaying:!1,isMobile:a.innerWidth<=640,isPortrait:a.innerHeight>a.innerWidth,musicVolume:.45,didInitialReset:!1,deferredPrompt:null,installButton:null,isInstallable:!1,allowFullscreen:!1,pendingFullscreen:!1};return{window:a,document:o,dom:x,state:X}}function U(a){const{state:o,window:t}=a;o.isMobile=t.innerWidth<=640,o.isPortrait=t.innerHeight>t.innerWidth}function it(a=window){var t,r,u,i,l,b;const o=((t=a.navigator)==null?void 0:t.userAgent)||"";return{isIOS:/iPad|iPhone|iPod/.test(o),isAndroid:/Android/.test(o),isSafari:/Safari/.test(o)&&!/Chrome/.test(o),isChrome:/Chrome/.test(o)&&!/Edg/.test(o),isFirefox:/Firefox/.test(o),isEdge:/Edg/.test(o),isSamsung:/Samsung/.test(o),isTouch:"ontouchstart"in a||(((r=a.navigator)==null?void 0:r.maxTouchPoints)||0)>0,supportsVibration:typeof((u=a.navigator)==null?void 0:u.vibrate)=="function"||typeof((i=a.navigator)==null?void 0:i.webkitVibrate)=="function"||typeof((l=a.navigator)==null?void 0:l.mozVibrate)=="function"||typeof((b=a.navigator)==null?void 0:b.msVibrate)=="function",supportsOrientation:"orientation"in a||"onorientationchange"in a}}function ot(a,o){const{document:t,state:r,window:u}=a,i=t.body;if(i){if(o.isIOS){i.classList.add("ios-device"),i.style.overflow="hidden",i.style.position="fixed",i.style.width="100%",i.style.height="100%";const l=t.querySelector('meta[name="viewport"]');l&&(l.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover")}o.isAndroid&&(i.classList.add("android-device"),i.style.transform="translateZ(0)"),o.isSamsung&&i.classList.add("samsung-browser"),r.isMobile&&K(a,0),U(a),setTimeout(()=>Q(a,o),100),o.supportsOrientation&&u.addEventListener("orientationchange",()=>{setTimeout(()=>{U(a),st(a,o)},200)})}}async function Q(a,o){const{state:t,document:r}=a;U(a);const u=t.isMobile&&!t.isPortrait,i=lt(r);if(u&&!i)if(t.allowFullscreen)try{await at(r),t.pendingFullscreen=!1}catch(b){t.pendingFullscreen=!0,console.log("Fullscreen request was blocked:",b)}else t.pendingFullscreen=!0;else(!u||t.isPortrait)&&i&&(rt(r),t.pendingFullscreen=!1);const l=r.getElementById("rotation-notice");l&&(l.style.display=t.isMobile&&t.isPortrait?"flex":"none"),o.supportsOrientation&&t.isMobile&&K(a,50)}function st(a,o){const{state:t}=a;U(a),t.isMobile&&!t.isPortrait&&(t.pendingFullscreen=!0),Q(a,o)}function K(a,o){const{state:t,window:r}=a;if(!t.isMobile)return;const u=r.navigator;if(!u)return;const i=u.vibrate||u.webkitVibrate||u.mozVibrate||u.msVibrate;if(typeof i=="function"&&o)try{i.call(u,o)}catch(l){console.log("Vibration not supported:",l)}}function at(a=document){const o=a.documentElement;return o.requestFullscreen?o.requestFullscreen():o.webkitRequestFullscreen?o.webkitRequestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.msRequestFullscreen?o.msRequestFullscreen():Promise.reject(new Error("Fullscreen API not supported"))}function rt(a=document){a.exitFullscreen?a.exitFullscreen().catch(()=>{}):a.webkitExitFullscreen?a.webkitExitFullscreen():a.mozCancelFullScreen?a.mozCancelFullScreen():a.msExitFullscreen&&a.msExitFullscreen()}function lt(a=document){return!!(a.fullscreenElement||a.webkitFullscreenElement||a.mozFullScreenElement||a.msFullscreenElement)}function ct(a){U(a);const{document:o,state:t}=a,r=o.getElementById("rotation-notice");r&&(r.style.display=t.isMobile&&t.isPortrait?"flex":"none")}function Z(a,o){const{state:t}=a;t.pendingFullscreen&&(t.allowFullscreen=!0,Q(a,o))}const dt=.15,ut=.15,ft=.1;function mt(a,o){const{state:t,window:r,document:u}=a;function i(){if(!t.audioContext)try{const s=r.AudioContext||r.webkitAudioContext||r.mozAudioContext||r.msAudioContext;if(!s){console.warn("Web Audio API не поддерживается в этом браузере");return}if(t.audioContext=new s,t.audioContext.state==="suspended"){const d=()=>{var M;(M=t.audioContext)==null||M.resume().finally(()=>{u.removeEventListener("touchstart",d),u.removeEventListener("click",d)})};u.addEventListener("touchstart",d,{once:!0}),u.addEventListener("click",d,{once:!0})}}catch(s){console.warn("Ошибка инициализации Web Audio API:",s),t.audioContext=null}}function l(){if(!t.audioContext||!t.musicEnabled)return;const s=t.audioContext.createOscillator(),d=t.audioContext.createOscillator(),M=t.audioContext.createGain(),B=t.audioContext.createBiquadFilter();s.type="square",d.type="sawtooth",M.gain.setValueAtTime(t.musicVolume,t.audioContext.currentTime),B.type="lowpass",B.frequency.setValueAtTime(1200,t.audioContext.currentTime),B.Q.setValueAtTime(1.5,t.audioContext.currentTime);const A=[261.63,329.63,392,523.25,392,493.88,587.33,783.99];let p=0;const y=()=>{if(!t.musicEnabled||!t.isMusicPlaying||!t.audioContext)return;const e=A[p],m=.15,f=t.audioContext.currentTime;s.frequency.setValueAtTime(e,f),d.frequency.setValueAtTime(e*.75,f),M.gain.cancelScheduledValues(f),M.gain.setValueAtTime(t.musicVolume,f),M.gain.exponentialRampToValueAtTime(Math.max(5e-4,t.musicVolume*.007),f+m),p=(p+1)%A.length},w=r.setInterval(y,250);s.connect(B),d.connect(B),B.connect(M),M.connect(t.audioContext.destination),s.start(),d.start(),t.backgroundMusic={oscillator1:s,oscillator2:d,gainNode:M,interval:w},y()}function b(){!t.musicEnabled||t.isMusicPlaying||(i(),t.audioContext&&(t.isMusicPlaying=!0,l()))}function R(){t.backgroundMusic&&(t.isMusicPlaying=!1,t.backgroundMusic.gainNode&&t.audioContext&&t.backgroundMusic.gainNode.gain.exponentialRampToValueAtTime(.001,t.audioContext.currentTime+.5),r.setTimeout(()=>{var s,d,M,B,A,p,y;(M=(d=(s=t.backgroundMusic)==null?void 0:s.oscillator1)==null?void 0:d.stop)==null||M.call(d),(p=(A=(B=t.backgroundMusic)==null?void 0:B.oscillator2)==null?void 0:A.stop)==null||p.call(A),(y=t.backgroundMusic)!=null&&y.interval&&r.clearInterval(t.backgroundMusic.interval),t.backgroundMusic=null},500))}function x(){if(!(!t.audioContext||!t.soundEnabled))try{const s=t.audioContext.createOscillator(),d=t.audioContext.createGain();s.type="sine",s.frequency.setValueAtTime(440,t.audioContext.currentTime),s.frequency.exponentialRampToValueAtTime(100,t.audioContext.currentTime+.1),d.gain.setValueAtTime(dt,t.audioContext.currentTime),d.gain.exponentialRampToValueAtTime(.001,t.audioContext.currentTime+.1),s.connect(d),d.connect(t.audioContext.destination),s.start(),s.stop(t.audioContext.currentTime+.1),K(a,o.isTouch?50:0)}catch(s){console.log("Error playing hit sound:",s)}}function X(){if(!(!t.audioContext||!t.soundEnabled))try{const s=t.audioContext.createOscillator(),d=t.audioContext.createGain();s.type="triangle",s.frequency.setValueAtTime(150,t.audioContext.currentTime),s.frequency.exponentialRampToValueAtTime(80,t.audioContext.currentTime+.15),d.gain.setValueAtTime(ut,t.audioContext.currentTime),d.gain.exponentialRampToValueAtTime(.001,t.audioContext.currentTime+.15),s.connect(d),d.connect(t.audioContext.destination),s.start(),s.stop(t.audioContext.currentTime+.15),K(a,o.isTouch?30:0)}catch(s){console.log("Error playing wall hit sound:",s)}}function q(){if(!(!t.audioContext||!t.soundEnabled)){console.log("playMeowSound called - soundEnabled:",t.soundEnabled,"audioContext:",!!t.audioContext);try{const s=t.audioContext.createOscillator(),d=t.audioContext.createGain();s.type="square",s.frequency.setValueAtTime(300,t.audioContext.currentTime),s.frequency.linearRampToValueAtTime(800,t.audioContext.currentTime+.1),s.frequency.linearRampToValueAtTime(400,t.audioContext.currentTime+.3),d.gain.setValueAtTime(ft,t.audioContext.currentTime),d.gain.exponentialRampToValueAtTime(.001,t.audioContext.currentTime+.3),s.connect(d),d.connect(t.audioContext.destination),s.start(),s.stop(t.audioContext.currentTime+.3),K(a,[100,50,100])}catch(s){console.log("Error playing meow sound:",s)}}}function F(){const s=u.getElementById("sound-toggle"),d=u.getElementById("sound-toggle-landscape");s&&(s.textContent=t.soundEnabled?"🔊":"🔇",s.title=t.soundEnabled?"Отключить звуковые эффекты (мяуканье, удары)":"Включить звуковые эффекты (мяуканье, удары)"),d&&(d.textContent=t.soundEnabled?"🔊":"🔇",d.title=t.soundEnabled?"Отключить звуковые эффекты":"Включить звуковые эффекты")}function k(){const s=u.getElementById("music-toggle"),d=u.getElementById("music-toggle-landscape");s&&(s.textContent=t.musicEnabled?"🎵":"🔇",s.title=t.musicEnabled?"Отключить фоновую музыку":"Включить фоновую музыку"),d&&(d.textContent=t.musicEnabled?"🎵":"🔇",d.title=t.musicEnabled?"Отключить фоновую музыку":"Включить фоновую музыку")}function P(s){const d=String(s),M=u.getElementById("music-volume"),B=u.getElementById("music-volume-landscape");M&&M.value!==d&&(M.value=d),B&&B.value!==d&&(B.value=d)}function Y(){var s;t.soundEnabled=!t.soundEnabled,F(),(s=r.localStorage)==null||s.setItem("kitt-cues-sound",String(t.soundEnabled))}function O(){var s;t.musicEnabled=!t.musicEnabled,k(),t.musicEnabled?b():R(),(s=r.localStorage)==null||s.setItem("kitt-cues-music",String(t.musicEnabled))}function C(s){var M,B;const d=Math.max(0,Math.min(100,Number(s)));t.musicVolume=d/100,(M=t.backgroundMusic)!=null&&M.gainNode&&t.audioContext&&t.backgroundMusic.gainNode.gain.setTargetAtTime(t.musicVolume,t.audioContext.currentTime,.05),(B=r.localStorage)==null||B.setItem("kitt-cues-music-volume",String(d)),P(d)}function c(){var B,A,p;const s=(B=r.localStorage)==null?void 0:B.getItem("kitt-cues-sound");s!==null&&(t.soundEnabled=s==="true");const d=(A=r.localStorage)==null?void 0:A.getItem("kitt-cues-music");d!==null&&(t.musicEnabled=d==="true");const M=(p=r.localStorage)==null?void 0:p.getItem("kitt-cues-music-volume");M!==null&&!Number.isNaN(Number(M))&&(t.musicVolume=Math.max(0,Math.min(100,Number(M)))/100),F(),k(),P(Math.round(t.musicVolume*100))}return{initAudio:i,startBackgroundMusic:b,stopBackgroundMusic:R,playHitSound:x,playWallHitSound:X,playMeowSound:q,toggleSound:Y,toggleMusic:O,setMusicVolumeFromPercent:C,loadPreferences:c}}function J(a,o,t){const r=a*o;return Math.abs(r)<t?0:r}function gt(a,o){const t=o.x-a.x,r=o.y-a.y,u=Math.sqrt(t*t+r*r)||1,i=Math.atan2(r,t),l=Math.sin(i),b=Math.cos(i),R=tt(a.vx,a.vy,l,b),x=tt(o.vx,o.vy,l,b),X=x.x,q=R.x,F=et(X,R.y,l,b),k=et(q,x.y,l,b),P=a.radius+o.radius-u+1,Y=P/2*b,O=P/2*l;return{ballA:{vx:F.x,vy:F.y,dx:-Y,dy:-O},ballB:{vx:k.x,vy:k.y,dx:Y,dy:O}}}function tt(a,o,t,r){return{x:a*r+o*t,y:o*r-a*t}}function et(a,o,t,r){return{x:a*r-o*t,y:o*r+a*t}}function pt(a,o){const{dom:t,document:r,window:u,state:i}=a,{playHitSound:l,playWallHitSound:b,playMeowSound:R}=o,x=new Set;function X(){x.forEach(e=>{try{e()}catch(m){console.error("Balls stopped listener error:",m)}})}function q(e){x.add(e)}function F(e){x.delete(e)}function k(){i.cats=[];const{table:e}=t;if(!e)return;const m=r.querySelectorAll(".cat-container"),f=e.getBoundingClientRect();m.forEach(h=>{const v=h.getBoundingClientRect(),T=v.left-f.left+v.width/2,L=v.top-f.top+v.height/2;let W=Math.max(v.width,v.height)/2;h.classList.contains("cat-small")&&(W=Math.max(v.width,v.height)/2),i.isMobile&&(W*=.1),i.cats.push({el:h,pawEl:h.querySelector(".hitting-paw"),x:T,y:L,radius:W,cooldown:0})})}function P(){i.pockets=[];const{table:e}=t;if(!e)return;const m=r.querySelectorAll("[data-pocket]"),f=e.getBoundingClientRect();m.forEach(h=>{const v=h.getBoundingClientRect(),T=v.left-f.left+v.width/2,L=v.top-f.top+v.height/2,W=Math.max(h.offsetWidth,h.offsetHeight)/2;let n=Math.max(6,W*.95);i.isMobile&&(n=Math.max(4,W*.5)),i.pockets.push({x:T,y:L,radius:n})})}function Y(){const{table:e,pyramidContainer:m}=t;if(!e)return;i.balls=[];const f=r.querySelectorAll(".billiard-ball");m&&(m.style.display="block"),f.forEach(h=>{h.style.transform="",h.style.display="block";const v=e.getBoundingClientRect(),T=h.getBoundingClientRect(),L=T.left-v.left+T.width/2,W=T.top-v.top+T.height/2;i.balls.push({el:h,x:L,y:W,vx:0,vy:0,radius:h.offsetWidth/2,sunk:!1}),e.appendChild(h),h.style.position="absolute",h.style.left="0px",h.style.top="0px"}),m&&(m.innerHTML="",m.style.display="none"),s()}function O(){const e=r.getElementById("score-display"),m=r.getElementById("score-display-landscape");e&&(e.textContent=`Счет: ${i.score}`),m&&(m.textContent=`Счет: ${i.score}`)}function C(e){const{table:m}=t;m&&i.cats.forEach(f=>{try{const h=r.createElement("div");h.className="cat-emoji",h.textContent=e;const T=(f.el.querySelector(".cat-head")||f.el).getBoundingClientRect(),L=m.getBoundingClientRect(),W=T.left-L.left+T.width/2,n=T.top-L.top-6;h.style.left=`${W}px`,h.style.top=`${n}px`,m.appendChild(h),u.setTimeout(()=>{h.remove()},1300)}catch(h){console.log("Unable to show cat emoji:",h)}})}function c(){i.cats.forEach(e=>{e.cooldown>0&&e.cooldown--}),i.balls.forEach(e=>{if(e.sunk||(e.vx=J(e.vx,i.friction,i.minVelocity),e.vy=J(e.vy,i.friction,i.minVelocity),e.vx===0&&e.vy===0)||(e.x+=e.vx,e.y+=e.vy,i.pockets.forEach(f=>{const h=e.x-f.x,v=e.y-f.y;Math.sqrt(h*h+v*v)+e.radius<f.radius&&!e.sunk&&(e.sunk=!0,e.vx=0,e.vy=0,e.el.style.display="none",e.el.id!=="cue-ball"?(i.score++,O(),l(),C("😿")):(C("😺"),u.setTimeout(()=>{const{table:L}=t;L&&(e.x=L.offsetWidth*.25,e.y=L.offsetHeight*.5,e.vx=0,e.vy=0,e.sunk=!1,e.el.style.display="block",s())},1e3)))}),e.sunk))return;const{table:m}=t;m&&((e.x-e.radius<0&&e.vx<0||e.x+e.radius>m.offsetWidth&&e.vx>0)&&(e.vx*=-1,b(),e.x-e.radius<0&&(e.x=e.radius),e.x+e.radius>m.offsetWidth&&(e.x=m.offsetWidth-e.radius)),(e.y-e.radius<0&&e.vy<0||e.y+e.radius>m.offsetHeight&&e.vy>0)&&(e.vy*=-1,b(),e.y-e.radius<0&&(e.y=e.radius),e.y+e.radius>m.offsetHeight&&(e.y=m.offsetHeight-e.radius)),i.cats.forEach(f=>{if(f.cooldown>0||e.sunk)return;const h=e.x-f.x,v=e.y-f.y,T=Math.sqrt(h*h+v*v);if(T<e.radius+f.radius){if(i.isMobile&&Math.hypot(e.vx,e.vy)<3)return;if(R(),f.cooldown=i.isMobile?i.catCooldown*2:i.catCooldown,f.el.classList.contains("cat-small"))f.el.classList.add("swat-animation"),u.setTimeout(()=>f.el.classList.remove("swat-animation"),500);else{const g=f.pawEl||f.el;g.classList.add("swat-animation"),u.setTimeout(()=>g.classList.remove("swat-animation"),300)}const L=Math.atan2(v,h),W=i.isMobile?Math.max(1,i.pawHitPower*.25):i.pawHitPower;e.vx=Math.cos(L)*W,e.vy=Math.sin(L)*W;const n=e.radius+f.radius-T+1;e.x+=Math.cos(L)*n,e.y+=Math.sin(L)*n}}))});for(let e=0;e<i.balls.length;e++)if(!i.balls[e].sunk)for(let m=e+1;m<i.balls.length;m++){if(i.balls[m].sunk)continue;const f=i.balls[e],h=i.balls[m];if(Math.hypot(h.x-f.x,h.y-f.y)<f.radius+h.radius){const{ballA:T,ballB:L}=gt(f,h);f.vx=T.vx,f.vy=T.vy,h.vx=L.vx,h.vy=L.vy,f.x+=T.dx,f.y+=T.dy,h.x+=L.dx,h.y+=L.dy,l()}}}function s(){i.balls.forEach(e=>{e.sunk||(e.el.style.left="0px",e.el.style.top="0px",e.el.style.transform=`translate(${e.x-e.radius}px, ${e.y-e.radius}px)`)})}function d(){c(),s(),i.balls.every(m=>m.sunk||m.vx===0&&m.vy===0)?(i.animationFrameId&&(u.cancelAnimationFrame(i.animationFrameId),i.animationFrameId=null),X()):i.animationFrameId=u.requestAnimationFrame(d)}function M(){i.animationFrameId||(i.animationFrameId=u.requestAnimationFrame(d))}function B(){i.animationFrameId&&(u.cancelAnimationFrame(i.animationFrameId),i.animationFrameId=null)}function A(){return i.balls.find(e=>e.el.id==="cue-ball")}function p(){var V;B(),i.score=0,O(),P(),Y(),i.balls.forEach(I=>{I.sunk=!1,I.vx=0,I.vy=0,I.el.style.display="block"});const e=A(),{table:m}=t;e&&m&&(e.x=m.offsetWidth*.25,e.y=m.offsetHeight*.5),i.cueAngle=0;const f=i.balls.filter(I=>I.el.id!=="cue-ball"),h=((V=f[0])==null?void 0:V.radius)||12,v=(m==null?void 0:m.offsetWidth)||0,T=(m==null?void 0:m.offsetHeight)||0,L=Math.min(v*.6,v-h*8),W=T*.5,n=Math.min(h*2.2,(v-L)/4);let g=0;const E=(I,H,z)=>{I.x=Math.max(h,Math.min(v-h,H)),I.y=Math.max(h,Math.min(T-h,z))};if(g<f.length&&(E(f[g],L,W),g++),g<f.length&&(E(f[g],L+n,W-n*.5),g++),g<f.length&&(E(f[g],L+n,W+n*.5),g++),[{dx:2,dy:-1},{dx:2,dy:0},{dx:2,dy:1}].forEach(({dx:I,dy:H})=>{g<f.length&&(E(f[g],L+n*I,W+n*H),g++)}),[{dx:3,dy:-1.5},{dx:3,dy:-.5},{dx:3,dy:.5},{dx:3,dy:1.5}].forEach(({dx:I,dy:H})=>{g<f.length&&(E(f[g],L+n*I,W+n*H),g++)}),s(),e&&t.cue){const I=e.radius+10,H=e.x+Math.cos(i.cueAngle)*I,z=e.y+Math.sin(i.cueAngle)*I,j=i.cueAngle*(180/Math.PI);t.cue.style.visibility="visible",t.cue.style.transformOrigin="left center",t.cue.style.left="0px",t.cue.style.top="0px",t.cue.style.transform=`translate(${H}px, ${z-t.cue.offsetHeight/2}px) rotate(${j}deg)`}}function y(){return!!i.animationFrameId}function w(){i.isMobile?(i.friction=.8,i.minVelocity=.07,i.hitPower=7):(i.friction=.985,i.minVelocity=.05,i.hitPower=15)}return w(),{initCats:k,initPockets:P,initBalls:Y,updateScoreDisplays:O,updatePhysics:c,render:s,startLoop:M,stopLoop:B,resetGame:p,getCueBall:A,onBallsStopped:q,removeBallsStoppedListener:F,isAnyBallMoving:y,applyMobilePhysicsTweaks:w}}function ht(a,o){let t;return(...r)=>{t&&clearTimeout(t),t=setTimeout(()=>a(...r),o)}}function yt(a,o){const{document:t,window:r,dom:u,state:i}=a;function l(q,F){const Y=q/600,O=F/400,C=Math.min(Y,O);if(t.querySelectorAll(".cat-container").forEach(p=>{let y=1;r.innerWidth<=280?y=.1:r.innerWidth<=320?y=.15:r.innerWidth<=375?y=.2:r.innerWidth<=640?y=.3:r.innerWidth<=1024&&(y=1.1);const w=Math.max(.05,y*C);p.dataset.baseTransform||(p.dataset.baseTransform=p.style.transform||"");const e=p.dataset.baseTransform,m=[];e&&e.trim().length>0&&m.push(e.trim()),m.push(`scale(${w})`),p.style.transform=m.join(" ")}),t.querySelectorAll(".billiard-ball").forEach(p=>{let y=16;r.innerWidth<=280?y=4:r.innerWidth<=320?y=5:r.innerWidth<=375?y=6:r.innerWidth<=640&&(y=10);const w=Math.max(3,y*C);p.style.width=`${w}px`,p.style.height=`${w}px`}),t.querySelectorAll("[data-pocket]").forEach(p=>{let y=32;r.innerWidth<=280?y=12:r.innerWidth<=320?y=14:r.innerWidth<=375?y=16:r.innerWidth<=640&&(y=20);const w=Math.max(.8,C),e=Math.max(8,y*w);p.style.width=`${e}px`,p.style.height=`${e}px`}),u.cue){let p=8,y=40;r.innerWidth<=280?(p=1,y=10):r.innerWidth<=320?(p=1,y=15):r.innerWidth<=375?(p=1,y=20):r.innerWidth<=640&&(p=1,y=25);const w=Math.max(1,p*C),e=Math.max(5,y);u.cue.style.height=`${w}px`,u.cue.style.width=`${e}%`}t.querySelectorAll("button").forEach(p=>{if(p.closest(".landscape-mobile-controls"))return;let y=16,w=16,e=8,m=40,f=40;r.innerWidth<=320?(y=8,w=4,e=2,m=12,f=12):r.innerWidth<=375?(y=10,w=6,e=3,m=16,f=16):r.innerWidth<=640&&(y=12,w=8,e=4,m=20,f=20);const h=Math.max(6,y*C),v=Math.max(2,w*C),T=Math.max(1,e*C),L=Math.max(10,m*C),W=Math.max(10,f*C);p.style.fontSize=`${h}px`,p.style.padding=`${T}px ${v}px`,p.style.minWidth=`${L}px`,p.style.minHeight=`${W}px`}),t.querySelectorAll(".landscape-mobile-controls button").forEach(p=>{let y=10,w=4,e=2,m=16,f=16;r.innerWidth<=320&&(y=6,w=2,e=1,m=10,f=10);const h=Math.max(4,y*C),v=Math.max(1,w*C),T=Math.max(1,e*C),L=Math.max(8,m*C),W=Math.max(8,f*C);p.style.fontSize=`${h}px`,p.style.padding=`${T}px ${v}px`,p.style.minWidth=`${L}px`,p.style.minHeight=`${W}px`}),[t.getElementById("score-display"),t.getElementById("score-display-landscape")].forEach(p=>{if(!p)return;let y=18,w=32,e=16;r.innerWidth<=320?(y=8,w=8,e=4):r.innerWidth<=375?(y=10,w=12,e=6):r.innerWidth<=640?(y=14,w=16,e=8):p.id==="score-display-landscape"&&(y=12,w=12,e=4);const m=Math.max(8,y*C),f=Math.max(4,w*C),h=Math.max(2,e*C);if(p.style.fontSize=`${m}px`,p.style.padding=`${h}px ${f}px`,p.id==="score-display"){const T=Math.max(40,80*C);p.style.minWidth=`${T}px`}})}function b(){var p,y,w;const{gameArea:q,powerIndicator:F}=u;if(!q||!u.table)return;const k=q.getBoundingClientRect(),P=(p=u.table.parentElement)==null?void 0:p.getBoundingClientRect();if(!P)return;const O=Math.min(P.width/600,1.5),C=Math.max(10,20*O),c=(y=t.querySelector("#sound-toggle"))==null?void 0:y.parentElement;if(c&&P){const e=P.left-k.left-c.offsetWidth-C;c.style.left=`${Math.max(10,e)}px`,c.style.right="auto"}const d=(k.width-u.table.parentElement.offsetWidth)/2+u.table.parentElement.offsetWidth+C,M=t.getElementById("reset-button");if(M!=null&&M.parentElement){const e=M.parentElement;e.style.left=`${d}px`,e.style.right="auto";const m=t.getElementById("score-display");if(m!=null&&m.parentElement){const f=m.parentElement,h=P.top-k.top-f.offsetHeight-C;f.style.top=`${Math.max(10,h)}px`,f.style.left=`${d}px`,f.style.right="auto",f.style.bottom="auto"}}const B=t.querySelector(".landscape-mobile-controls");if(B){const e=P.top-k.top-B.offsetHeight-C;B.style.top=`${Math.max(10,e)}px`,B.style.bottom="auto"}const A=(w=t.getElementById("score-display-landscape"))==null?void 0:w.parentElement;if(A){const e=P.top-k.top-A.offsetHeight-C;A.style.top=`${Math.max(10,e)}px`,A.style.bottom="auto"}F&&(F.style.left=`${u.table.offsetWidth*.5-50}px`,F.style.top=`${u.table.offsetHeight*.5-30}px`)}function R(){U(a);const{gameArea:q}=u,F=u.table,k=t.getElementById("billiard-table-container");if(!q||!F||!k)return;const P=r.getComputedStyle(q),Y=parseFloat(P.paddingLeft),O=parseFloat(P.paddingRight),C=parseFloat(P.paddingTop),c=parseFloat(P.paddingBottom),s=q.getBoundingClientRect(),d=s.width-Y-O,M=s.height-C-c,B=1.5;let A,p;d/M>B?(p=M,A=p*B):(A=d,p=A/B);const y=20,w=A+y*2,e=p+y*2;k.style.width=`${w}px`,k.style.height=`${e}px`,k.style.left=`${Y+(d-w)/2}px`,k.style.top=`${C+(M-e)/2}px`,F.style.width=`${A}px`,F.style.height=`${p}px`,F.style.left=`${y}px`,F.style.top=`${y}px`,l(A,p),o.initCats(),o.initPockets(),o.initBalls(),r.setTimeout(()=>{b()},50)}const x=()=>{R(),b(),i.didInitialReset||(o.resetGame(),i.didInitialReset=!0)},X=ht(x,100);return{recomputeLayout:x,debouncedRecomputeLayout:X,handleResize:R,positionUIElements:b}}function xt(a,o,t,r,u,i){const{dom:l,document:b,window:R,state:x}=a,{initAudio:X,playHitSound:q,toggleSound:F,toggleMusic:k,setMusicVolumeFromPercent:P,loadPreferences:Y,startBackgroundMusic:O}=t;function C(n,g,E){const S=Math.atan2(Math.sin(g-n),Math.cos(g-n));return n+S*E}function c(n,g,E){if(!l.aimLine)return;const S=150;l.aimLine.style.left="0px",l.aimLine.style.top="0px",l.aimLine.style.width=`${S}px`,l.aimLine.style.transform=`translate(${n}px, ${g-1}px) rotate(${E*(180/Math.PI)}deg)`,l.aimLine.style.transformOrigin="left center",x.isDragging&&l.aimLine.classList.add("visible")}function s(n){if(!l.powerIndicator||!l.powerFill)return;const E=Math.min(n/25*100,100);if(l.powerFill.style.width=`${E}%`,x.isDragging&&n>0){l.powerIndicator.classList.add("visible");const S=o.getCueBall();S&&(l.powerIndicator.style.left=`${S.x-50}px`,l.powerIndicator.style.top=`${S.y-30}px`)}}function d(){var n,g;(n=l.aimLine)==null||n.classList.remove("visible"),(g=l.powerIndicator)==null||g.classList.remove("visible")}function M(n){const g=o.getCueBall();if(!g||!n)return;const E=l.table.getBoundingClientRect();let S,$;if("touches"in n&&n.touches.length>0?(S=n.touches[0].clientX,$=n.touches[0].clientY):(S=n.clientX,$=n.clientY),S===void 0||$===void 0)return;let V=S-E.left,I=$-E.top;const H=20;V=Math.max(H,Math.min(l.table.offsetWidth-H,V)),I=Math.max(H,Math.min(l.table.offsetHeight-H,I));const z=Math.atan2(I-g.y,V-g.x),j=x.isMobile?.08:.15;x.cueAngle=C(x.cueAngle,z,j);const _=x.cueAngle*(180/Math.PI),G=g.radius+6,D=g.x+Math.cos(x.cueAngle)*G,N=g.y+Math.sin(x.cueAngle)*G;l.cue.style.transformOrigin="left center",l.cue.style.left="0px",l.cue.style.top="0px",l.cue.style.transform=`translate(${D}px, ${N-l.cue.offsetHeight/2}px) rotate(${_}deg)`,c(g.x,g.y,x.cueAngle+Math.PI)}function B(n){var $,V;if(o.isAnyBallMoving()||n.target.tagName==="BUTTON"||n.target.closest("button"))return;x.allowFullscreen=!0,Z(a,r),x.isDragging=!0;const g=l.table.getBoundingClientRect();let E,S;"touches"in n&&n.touches.length>0?(E=n.touches[0].clientX,S=n.touches[0].clientY):(E=n.clientX,S=n.clientY),!(E===void 0||S===void 0)&&(x.dragStartX=E-g.left,x.dragStartY=S-g.top,M(n),($=l.aimLine)==null||$.classList.add("visible"),(V=l.powerIndicator)==null||V.classList.add("visible"))}function A(n){var z,j;if(!x.isDragging||o.isAnyBallMoving()){x.isDragging=!1,d();return}if(((z=n==null?void 0:n.target)==null?void 0:z.tagName)==="BUTTON"||(j=n==null?void 0:n.target)!=null&&j.closest("button")){x.isDragging=!1,d();return}x.isDragging=!1;const g=l.table.getBoundingClientRect();let E,S;n&&"touches"in n&&n.touches.length>0?(E=n.touches[0].clientX,S=n.touches[0].clientY):n&&"changedTouches"in n&&n.changedTouches.length>0?(E=n.changedTouches[0].clientX,S=n.changedTouches[0].clientY):n?(E=n.clientX,S=n.clientY):(E=x.dragStartX+g.left,S=x.dragStartY+g.top);const $=E-g.left,V=S-g.top,I=Math.sqrt(($-x.dragStartX)**2+(V-x.dragStartY)**2);let H=Math.min(I/6,25);I<10&&(H=x.hitPower),d(),p(H)}function p(n=x.hitPower){var I;if(X(),o.isAnyBallMoving())return;const g=o.getCueBall();if(!g)return;if(q(),(I=R.navigator)!=null&&I.vibrate&&x.isMobile){const H=Math.min(n*2,30);R.navigator.vibrate(H)}g.vx=-Math.cos(x.cueAngle)*n,g.vy=-Math.sin(x.cueAngle)*n;const E=x.cueAngle*(180/Math.PI),S=`rotate(${E}deg)`,$=Math.min(n*.8,30),V=`rotate(${E}deg) translateX(-${$}px)`;l.cue.style.transform=V,R.setTimeout(()=>{l.cue.style.transform=S},100),o.startLoop(),l.cue.style.visibility="hidden"}function y(){const n=o.getCueBall();if(!n||!l.cue)return;const g=n.radius+4,E=n.x+Math.cos(x.cueAngle)*g,S=n.y+Math.sin(x.cueAngle)*g,$=x.cueAngle*(180/Math.PI);l.cue.style.visibility="visible",l.cue.style.transformOrigin="left center",l.cue.style.left="0px",l.cue.style.top="0px",l.cue.style.transform=`translate(${E}px, ${S-l.cue.offsetHeight/2}px) rotate(${$}deg)`}function w(n,g){n&&(r.isTouch?(n.addEventListener("touchstart",E=>{E.preventDefault(),E.stopPropagation(),x.allowFullscreen=!0,Z(a,r),g()},{passive:!1}),n.addEventListener("click",E=>{E.preventDefault(),E.stopPropagation()})):n.addEventListener("click",E=>{E.preventDefault(),E.stopPropagation(),x.allowFullscreen=!0,Z(a,r),g()}),n.addEventListener("touchstart",()=>{n.style.transform="scale(0.95)"},{passive:!0}),n.addEventListener("touchend",()=>{n.style.transform="scale(1)"},{passive:!0}),n.addEventListener("mousedown",()=>{n.style.transform="scale(0.95)"}),n.addEventListener("mouseup",()=>{n.style.transform="scale(1)"}))}function e(){const n=b.getElementById("help-modal");if(n){n.classList.remove("hidden"),b.body.style.overflow="hidden",b.body.style.touchAction="auto";const g=n.querySelector(".overflow-y-auto");g&&(g.scrollTop=0)}}function m(){const n=b.getElementById("help-modal");n&&(n.classList.add("hidden"),b.body.style.overflow="",b.body.style.touchAction="none")}function f(){const n=b.getElementById("reset-button"),g=b.getElementById("sound-toggle"),E=b.getElementById("music-toggle"),S=b.getElementById("help-button"),$=b.getElementById("close-help"),V=b.getElementById("music-volume"),I=b.getElementById("sound-toggle-landscape"),H=b.getElementById("music-toggle-landscape"),z=b.getElementById("help-button-landscape"),j=b.getElementById("reset-button-landscape"),_=b.getElementById("music-volume-landscape");w(n,o.resetGame),w(g,F),w(E,k),w(S,e),w(I,F),w(H,k),w(z,e),w(j,o.resetGame),w($,m),V&&(V.addEventListener("input",D=>P(D.target.value)),V.addEventListener("change",D=>P(D.target.value))),_&&(_.addEventListener("input",D=>P(D.target.value)),_.addEventListener("change",D=>P(D.target.value)));const G=b.getElementById("help-modal");if(G){G.addEventListener("click",N=>{N.target.id==="help-modal"&&m()});const D=G.querySelector(".bg-white");D&&(D.addEventListener("click",N=>N.stopPropagation()),D.addEventListener("touchstart",N=>N.stopPropagation()),D.addEventListener("touchmove",N=>{N.target.closest(".overflow-y-auto")||N.preventDefault()},{passive:!1}))}}function h(){l.gameArea.addEventListener("mousemove",n=>{if(M(n),x.isDragging){const g=l.table.getBoundingClientRect(),E=n.clientX-g.left,S=n.clientY-g.top,$=Math.sqrt((E-x.dragStartX)**2+(S-x.dragStartY)**2);s(Math.min($/6,25))}}),l.gameArea.addEventListener("mousedown",B),R.addEventListener("mouseup",A),l.gameArea.addEventListener("touchmove",n=>{const g=b.getElementById("help-modal");if(!(g&&!g.classList.contains("hidden"))&&(n.preventDefault(),n.stopPropagation(),M(n),x.isDragging)){const E=l.table.getBoundingClientRect(),S=n.touches[0]||n.changedTouches[0],$=S.clientX-E.left,V=S.clientY-E.top,I=Math.sqrt(($-x.dragStartX)**2+(V-x.dragStartY)**2);s(Math.min(I/6,25))}},{passive:!1}),l.gameArea.addEventListener("touchstart",n=>{const g=b.getElementById("help-modal");g&&!g.classList.contains("hidden")||(n.preventDefault(),n.stopPropagation(),B(n))},{passive:!1}),l.gameArea.addEventListener("touchend",n=>{n.preventDefault(),n.stopPropagation(),A(n)},{passive:!1}),l.gameArea.addEventListener("contextmenu",n=>(n.preventDefault(),!1)),l.gameArea.addEventListener("gesturestart",n=>{n.preventDefault()}),l.gameArea.addEventListener("gesturechange",n=>{n.preventDefault()}),l.gameArea.addEventListener("gestureend",n=>{n.preventDefault()}),b.addEventListener("keydown",n=>{n.key==="Escape"&&m(),(n.key==="h"||n.key==="H")&&e(),(n.key==="s"||n.key==="S")&&F(),(n.key==="m"||n.key==="M")&&k()})}function v(){o.onBallsStopped(y)}function T(){l.gameArea&&l.gameArea.classList.add("dynamic-scaling"),Y(),o.initCats(),o.initPockets(),u.positionUIElements(),L()}function L(){const n=()=>{x.musicEnabled&&(X(),O()),x.allowFullscreen=!0,Z(a,r),typeof i=="function"&&i(),b.removeEventListener("mousedown",n),b.removeEventListener("touchstart",n)};b.addEventListener("mousedown",n,{once:!0}),b.addEventListener("touchstart",n,{once:!0})}function W(){U(a),o.applyMobilePhysicsTweaks()}return{aimCue:M,startDrag:B,endDrag:A,hitBall:p,hideVisualHelpers:d,updatePowerIndicator:s,repositionCue:y,bindUI:f,bindInputEvents:h,setupBallStopBehaviour:v,prepareInitialState:T,handleResizeSideEffects:W}}const bt="1.0.0";function Et(a){const{state:o,window:t,document:r}=a;function u(){if(!o.installButton){const c=r.createElement("button");c.innerHTML="📱 Установить приложение",c.className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow text-sm sm:text-base md:text-lg fixed top-4 right-4 z-50 transition-all duration-300",c.id="pwa-install-button",c.style.display="none",c.addEventListener("click",b),r.body.appendChild(c),o.installButton=c}return o.installButton}function i(){const c=u();c.style.display="block",o.isInstallable=!0,setTimeout(()=>{c.style.transform="scale(1.05)",setTimeout(()=>{c.style.transform="scale(1)"},200)},100)}function l(){o.installButton&&(o.installButton.style.display="none"),o.isInstallable=!1}function b(){o.deferredPrompt?(o.deferredPrompt.prompt(),o.deferredPrompt.userChoice.then(c=>{c.outcome==="accepted"&&R(),o.deferredPrompt=null,l()}).catch(c=>{console.log("Ошибка при установке PWA:",c)})):x()}function R(){const c=t.navigator,s=(c==null?void 0:c.vibrate)||(c==null?void 0:c.webkitVibrate)||(c==null?void 0:c.mozVibrate)||(c==null?void 0:c.msVibrate);if(typeof s=="function")try{s.call(c,[100,50,100,50,100])}catch(d){console.log("Vibration not supported:",d)}}function x(){var s;const c=r.createElement("div");c.className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",c.innerHTML=`
            <div class="bg-white rounded-lg p-6 max-w-md w-full">
                <h3 class="text-lg font-bold mb-4">📱 Установка приложения</h3>
                <div class="text-sm text-gray-700 mb-4">
                    ${X()}
                </div>
                <button class="bg-blue-600 text-white px-4 py-2 rounded w-full">Понятно</button>
            </div>
        `,(s=c.querySelector("button"))==null||s.addEventListener("click",()=>c.remove()),r.body.appendChild(c),setTimeout(()=>c.remove(),1e4)}function X(){const c=t.navigator,s=/iPad|iPhone|iPod/.test((c==null?void 0:c.userAgent)||""),d=/Safari/.test((c==null?void 0:c.userAgent)||"")&&!/Chrome/.test((c==null?void 0:c.userAgent)||"");return s&&d?`
                <p class="mb-2">На iOS Safari:</p>
                <ol class="list-decimal list-inside space-y-1">
                    <li>Нажмите кнопку "Поделиться" в Safari</li>
                    <li>Выберите "На экран Домой"</li>
                    <li>Нажмите "Добавить"</li>
                </ol>
            `:`
            <p class="mb-2">В Chrome:</p>
            <ol class="list-decimal list-inside space-y-1">
                <li>Нажмите на меню (три точки)</li>
                <li>Выберите "Добавить на главный экран"</li>
                <li>Нажмите "Добавить"</li>
            </ol>
        `}function q(){const c=r.createElement("div");c.className="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-6 py-3 rounded-lg shadow-lg z-50",c.innerHTML=`
            <div class="flex items-center space-x-3">
                <span>🆕 Доступна новая версия</span>
                <button class="bg-white text-blue-600 px-3 py-1 rounded text-sm font-medium">Обновить</button>
                <button class="text-white hover:text-gray-200">✕</button>
            </div>
        `;const[s,d]=c.querySelectorAll("button");s==null||s.addEventListener("click",()=>t.location.reload()),d==null||d.addEventListener("click",()=>c.remove()),r.body.appendChild(c),setTimeout(()=>c.remove(),1e4)}function F(){if(!("serviceWorker"in t.navigator)){console.log("⚠️ Service Worker не поддерживается в этом браузере");return}t.addEventListener("load",()=>{const c=`/service-worker.js?v=${encodeURIComponent(bt)}`;t.navigator.serviceWorker.register(c).then(s=>{console.log("✅ Service Worker зарегистрирован успешно:",s.scope),s.addEventListener("updatefound",()=>{const d=s.installing;d==null||d.addEventListener("statechange",()=>{d.state==="installed"&&t.navigator.serviceWorker.controller&&q()})})}).catch(s=>{console.log("❌ Service Worker регистрация не удалась:",s)})})}function k(){if(t.matchMedia&&t.matchMedia("(display-mode: standalone)").matches){console.log("PWA уже установлено и запущено");return}const s=t.navigator,d=/iPad|iPhone|iPod/.test((s==null?void 0:s.userAgent)||""),M=/Safari/.test((s==null?void 0:s.userAgent)||"")&&!/Chrome/.test((s==null?void 0:s.userAgent)||"");d&&M&&setTimeout(i,3e3),setTimeout(()=>{!o.isInstallable&&!t.matchMedia("(display-mode: standalone)").matches&&i()},5e3)}function P(c){c.preventDefault(),o.deferredPrompt=c,i()}function Y(){l(),o.deferredPrompt=null;const c=r.createElement("div");c.className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300",c.innerHTML="✅ Приложение установлено!",r.body.appendChild(c),R(),setTimeout(()=>{c.style.transform="translate(-50%, -100%)",setTimeout(()=>c.remove(),300)},3e3)}function O(){t.addEventListener("DOMContentLoaded",()=>{t.matchMedia&&t.matchMedia("(display-mode: standalone)").matches?r.body.classList.add("pwa-mode"):k()})}function C(){t.addEventListener("beforeinstallprompt",P),t.addEventListener("appinstalled",Y),O()}return{registerServiceWorker:F,setupListeners:C,showInstallButton:i,hideInstallButton:l}}document.addEventListener("DOMContentLoaded",()=>{const a=nt(window,document),o=it(window),t=mt(a,o),r=pt(a,t),u=yt(a,r),i=xt(a,r,t,o,u,()=>Q(a,o)),l=Et(a);ot(a,o),i.bindUI(),i.bindInputEvents(),i.setupBallStopBehaviour(),i.prepareInitialState(),u.debouncedRecomputeLayout(),ct(a);const b=()=>{i.handleResizeSideEffects(),u.debouncedRecomputeLayout(),Q(a,o)};window.addEventListener("resize",b),window.addEventListener("orientationchange",()=>{setTimeout(b,200)}),l.registerServiceWorker(),l.setupListeners()});
